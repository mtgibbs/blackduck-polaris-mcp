{
  "project": "blackduck-polaris-mcp",
  "branchName": "ralph/repos-api",
  "description": "Implement the Repos Integration API client for the blackduck-polaris-mcp project. This covers the /api/integrations/repos service which manages SCM repository integrations, bulk imports, group settings, test settings, and connection testing. Adds src/api/repos.ts (API client), src/services/repos.ts (service layer), TypeScript types in src/types/polaris.ts, MCP tool registrations in src/mcp/tools/index.ts, and a new export in src/services/index.ts. Spec: specs/repos-integration.yaml (25 endpoints across 7 stories).",
  "userStories": [
    {
      "id": "PRD-R1",
      "title": "Foundation: API client, service layer, and types for Repos Integration",
      "description": "Create the greenfield file scaffolding for the Repos Integration API. This story sets up src/api/repos.ts, src/services/repos.ts, adds the service re-export to src/services/index.ts, and defines all TypeScript interfaces in src/types/polaris.ts. No MCP tools are registered in this story. Follow the patterns established by src/api/bug-tracking.ts and src/services/bug-tracking.ts.",
      "acceptanceCriteria": [
        "AC-1: Create src/api/repos.ts with `import { getClient } from \"./client.ts\"` and typed imports from `../types/polaris.ts`. Define vendor media-type constants for each unique Accept/Content-Type header in specs/repos-integration.yaml. At minimum these constants must be defined: ACCEPT_REPO_LIST = \"application/vnd.polaris.integrations.repos.repo-list-1+json;charset=UTF-8\" (spec line 71), ACCEPT_REPO = \"application/vnd.polaris.integrations.repos.repo-1+json;charset=UTF-8\" (spec line 134), ACCEPT_REPO_CREATE = \"application/vnd.polaris.integrations.repos.repo-create-1+json;charset=UTF-8\" (spec line 126), ACCEPT_REPO_UPDATE = \"application/vnd.polaris.integrations.repos.repo-update-1+json;charset=UTF-8\" (spec line 210), ACCEPT_REPO_CONNECTION = \"application/vnd.polaris.integrations.repos.repo-connection-1+json;charset=UTF-8\" (spec line 374), ACCEPT_CONNECTION_REQUEST = \"application/vnd.polaris.integrations.repos.connection-request-1+json;charset=UTF-8\" (spec line 366), ACCEPT_BRANCH_LIST = \"application/vnd.polaris.integrations.repos.repo-branch-list-1+json;charset=UTF-8\" (spec line 457), ACCEPT_GROUPS_AUTH = \"application/vnd.polaris.integrations.repos.scm.groups-auth-1+json;charset=UTF-8\" (spec line 513), ACCEPT_PROVIDERS_LIST = \"application/vnd.scm.providers-list-1+json;charset=UTF-8\" (spec line 601), ACCEPT_BULK_REPO_IMPORT = \"application/vnd.polaris.integrations.repos.bulk-repo-import-1+json;charset=UTF-8\" (spec line 670), ACCEPT_BULK_REPO_IMPORT_GROUPS_STATUS = \"application/vnd.polaris.integrations.repos.bulk-repo-import-groups-status-1+json;charset=UTF-8\" (spec line 896), ACCEPT_BULK_GROUP_IMPORT = \"application/vnd.polaris.integrations.repos.bulk-group-import-1+json;charset=UTF-8\" (spec line 994), ACCEPT_BULK_GROUP_IMPORT_STATUS = \"application/vnd.polaris.integrations.repos.bulk-group-import-status-1+json;charset=UTF-8\" (spec line 1310), ACCEPT_SCM_CONNECTION = \"application/vnd.polaris.integrations.repos.scm.repo-connection-1+json;charset=UTF-8\" (spec line 1558), ACCEPT_SCM_GROUPS = \"application/vnd.polaris.integrations.repos.scm.group-list-1+json;charset=UTF-8\" (spec line 1690), ACCEPT_SCM_REPOS = \"application/vnd.polaris.integrations.repos.scm.repo-list-1+json;charset=UTF-8\" (spec line 1849), ACCEPT_SCM_PROJECTS = \"application/vnd.polaris.integrations.repos.scm.project-list-1+json;charset=UTF-8\" (spec line 1984), ACCEPT_GROUPS_SETTINGS_UPDATE = \"application/vnd.polaris.integrations.repos.groups-settings-update-1+json;charset=UTF-8\" (spec line 2067), ACCEPT_GROUPS_SETTINGS = \"application/vnd.polaris.integrations.repos.groups-settings-1+json;charset=UTF-8\" (spec line 2157), ACCEPT_GROUP_CONNECTION_REQUEST = \"application/vnd.polaris.integrations.repos.groups-connection-request-1+json;charset=UTF-8\" (spec line 2236), ACCEPT_GROUP_MAPPING_STATUS = \"application/vnd.polaris.integrations.repos.group-mapping-status-1+json\" (spec line 2361 - note: no charset suffix), ACCEPT_TEST_SETTINGS_CREATE = \"application/vnd.polaris.integrations.repos.test-settings-create-1+json;charset=UTF-8\" (spec line 2412), ACCEPT_TEST_SETTINGS = \"application/vnd.polaris.integrations.repos.test-settings+json\" (spec line 2486 - note: no charset suffix). File must compile with `deno task check`.",
        "AC-2: Create src/services/repos.ts with `import * as reposApi from \"../api/repos.ts\"` and typed imports from `../types/polaris.ts`. The file should initially be a minimal scaffold with the import and be ready for service functions to be added in subsequent stories. File must compile with `deno task check`.",
        "AC-3: Add `export * from \"./repos.ts\";` to src/services/index.ts after the existing `export * from \"./bug-tracking.ts\";` line.",
        "AC-4: Add the following TypeScript types to src/types/polaris.ts in a new `// --- Repos Integration ---` section after the existing `// --- Bug Tracking ---` section. Types must match specs/repos-integration.yaml components/schemas:\n\n- ScmProvider type (union of string literals): \"GITHUB_STANDARD\" | \"GITHUB_ENTERPRISE_CLOUD\" | \"GITLAB_SAAS\" | \"BITBUCKET_CLOUD\" | \"AZURE_CLOUD\" | \"GITHUB_ENTERPRISE_SERVER\" | \"GITHUB_SELF_MANAGED\" | \"BITBUCKET_DATA_CENTER\" (spec line 3768-3781)\n- ScmHostingType type: \"CLOUD_HOSTED\" | \"SELF_HOSTED\" (spec line 3513-3515)\n- ScmAuthenticationMode type: \"PAT\" | \"OAUTH_2\" (spec line 3199-3201)\n- ScmRepository interface: id, organizationId, repositoryUrl, scmProvider (ScmProvider), applicationId, projectId, createdAt, updatedAt, createdBy, updatedBy - all string; optional _links (LinkEntry[]) (spec line 2881-2932)\n- ScmRepositoryWithBranch interface: extends ScmRepository fields plus optional defaultBranchName (string); response is wrapped in body property (spec line 3089-3153)\n- ScmRepositoryCreateResponse interface: same fields as ScmRepository plus optional _links (LinkEntry[]) (spec line 2933-2991)\n- ScmRepositoryPatchResponse interface: same fields as ScmRepository plus optional _links (LinkEntry[]) (spec line 2992-3050)\n- ScmRepositoryTestConnectionResponse interface: object (boolean), optional _links (LinkEntry[]) (spec line 3051-3070)\n- RepositoryBranch interface: name (string), sha (string), isDefault (boolean), isSynchronisedWithScm (boolean, optional) (spec line 2624-2640)\n- ScmProviderInfo interface: scmProvider (ScmProvider), scmHostingType (ScmHostingType), minVersion (string, optional), maxVersion (string, optional) (spec line 3506-3530)\n- ScmGroup interface: id (string), name (string) (spec line 3650-3662)\n- ScmRemoteRepository interface: id (string), organizationId (string, optional), repositoryUrl (string), scmProvider (ScmProvider), applicationId (string, optional), projectId (string, optional), createdAt (string, optional), updatedAt (string, optional), createdBy (string, optional), updatedBy (string, optional) (spec line 3678-3728)\n- ScmProject interface: id (string), name (string), url (string, optional), groupName (string, optional) (spec line 3730-3752)\n- GroupsSettings interface: email (string, optional), applicationId (string, optional), groupUrl (string, optional), scmProvider (ScmProvider, optional), settings (object with repository and branch sub-objects, optional) (spec line 3377-3393)\n- GroupMappingStatus interface: projectId (string), repoUrl (string, optional), isValidMapping (boolean) (spec line 2720-2737)\n- BulkRepoImportGroupStatus interface: id (string), portfolioItemId (string, optional), progressPercentage (number, optional), state (string, optional), stateInfo (string, optional), repositoriesImportStats (object with notStarted, inProgress, completed, failed, total fields, optional), importJob (object with id and createdAt, optional) (spec line 3589-3649)\n- BulkGroupImportJobStatus interface: id (string), progressPercentage (number, optional), state (string, optional), stateInfo (string, optional), groupsImportStats (object with notStarted, inProgress, completed, failed, total fields, optional), _links (LinkEntry[], optional) (spec line 3531-3588)\n- BulkGroupImportUpdateResponse interface: id (string), progress (number, optional), state (string, optional), info (array of { group, state, info } objects, optional), createdAt (string, optional), updatedAt (string, optional), createdBy (string, optional), updatedBy (string, optional), _links (LinkEntry[], optional) (spec line 3418-3485)\n- TestSettingsResponse interface: scope (string), scopeId (string), inherited (boolean, optional), testSyncSettings (TestSyncSettings, optional), _links (LinkEntry[], optional) (spec line 2738-2782)\n- TestSyncSettings interface: branch (BranchTestSyncSettings, optional) (spec line 2804-2808)\n- BranchTestSyncSettings interface: default (DefaultBranchSyncSettings, optional), nonDefault (NonDefaultBranchSyncSettings, optional) (spec line 2809-2815)\n- DefaultBranchSyncSettings interface: pullRequestMerged (boolean, optional), assessmentTypes (string[], optional) (spec line 2816-2829)\n- NonDefaultBranchSyncSettings interface: pullRequestMerged (boolean, optional), assessmentTypes (string[], optional) (spec line 2831-2845)",
        "AC-5: All new and modified files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 1,
      "passes": true,
      "notes": "Greenfield story. No existing files to modify except src/services/index.ts (add export) and src/types/polaris.ts (add types). Follow the exact import and export patterns from src/api/bug-tracking.ts and src/services/bug-tracking.ts. Media type constants should be defined at the top of src/api/repos.ts using const declarations. The ScmRepositoryWithBranch response is wrapped in a `body` property per the spec (line 3089-3094). Two Accept headers notably lack the ;charset=UTF-8 suffix: group-mapping-status (line 2361) and test-settings (line 2486).",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:32:52Z"
    },
    {
      "id": "PRD-R2",
      "title": "Core repository CRUD and connection testing",
      "description": "Implement the 6 core repository endpoints: list repos with filters (paginated), create repo, get repo by ID, update repo by ID, test repo connection, and get repo branches (paginated). Wire up API client functions in src/api/repos.ts, service layer functions in src/services/repos.ts, and register MCP tools in src/mcp/tools/index.ts.",
      "acceptanceCriteria": [
        "AC-1: In src/api/repos.ts, implement `getRepositories(params?: GetRepositoriesParams): Promise<ScmRepository[]>` using `client.getAllOffset<ScmRepository>(\"/api/integrations/repos\", queryParams, ACCEPT_REPO_LIST)`. GetRepositoriesParams interface has optional `filter` field mapped to `_filter` query param. (spec line 28-117, operationId: searchRepositoriesWithFilters)",
        "AC-2: In src/api/repos.ts, implement `createRepository(params: CreateRepositoryParams): Promise<ScmRepositoryCreateResponse>` using `client.fetch<ScmRepositoryCreateResponse>(\"/api/integrations/repos\", { method: \"POST\", body, accept: ACCEPT_REPO, contentType: ACCEPT_REPO_CREATE })`. CreateRepositoryParams includes required projectId, repositoryUrl, scmProvider (string), and optional applicationId, scmAuthentication ({ name?, authenticationMode?, authToken?, email? }). (spec line 118-191, operationId: createScmRepo)",
        "AC-3: In src/api/repos.ts, implement `getRepository(repoId: string, params?: GetRepositoryParams): Promise<ScmRepositoryWithBranch>` using `client.get<ScmRepositoryWithBranch>(\"/api/integrations/repos/${repoId}\", queryParams, ACCEPT_REPO)`. GetRepositoryParams has optional `include` field mapped to `_include` query param. (spec line 265-356, operationId: getRepository)",
        "AC-4: In src/api/repos.ts, implement `updateRepository(params: UpdateRepositoryParams): Promise<ScmRepositoryPatchResponse>` using `client.fetch<ScmRepositoryPatchResponse>(\"/api/integrations/repos/${params.repoId}\", { method: \"PATCH\", body, accept: ACCEPT_REPO, contentType: ACCEPT_REPO_UPDATE })`. UpdateRepositoryParams includes required repoId, and optional projectId, applicationId, repositoryUrl, scmProvider, scmAuthentication. (spec line 192-264, operationId: updateRepositoryConfigByRepositoryId)",
        "AC-5: In src/api/repos.ts, implement `testRepoConnection(params: TestRepoConnectionParams): Promise<ScmRepositoryTestConnectionResponse>` using `client.fetch<ScmRepositoryTestConnectionResponse>(\"/api/integrations/repos/test-connection\", { method: \"POST\", body, accept: ACCEPT_REPO_CONNECTION, contentType: ACCEPT_CONNECTION_REQUEST })`. TestRepoConnectionParams includes projectId, repositoryUrl, scmProvider, and optional applicationId, scmAuthentication. (spec line 357-420, operationId: testConnectionRepo)",
        "AC-6: In src/api/repos.ts, implement `getRepositoryBranches(params: GetRepositoryBranchesParams): Promise<RepositoryBranch[]>` using `client.getAllOffset<RepositoryBranch>(\"/api/integrations/repos/${params.repoId}/branches\", undefined, ACCEPT_BRANCH_LIST)`. GetRepositoryBranchesParams has required `repoId`. (spec line 421-503, operationId: getAllBranchesForRepo)",
        "AC-7: In src/services/repos.ts, implement corresponding service functions with options objects: `getScmRepositories(options?: { filter?: string })`, `createScmRepository(options: { projectId: string; repositoryUrl: string; scmProvider: string; applicationId?: string; authName?: string; authMode?: string; authToken?: string; authEmail?: string })`, `getScmRepository(options: { repoId: string; include?: string })`, `updateScmRepository(options: { repoId: string; projectId?: string; applicationId?: string; repositoryUrl?: string; scmProvider?: string })`, `testScmRepoConnection(options: { projectId: string; repositoryUrl: string; scmProvider: string })`, `getScmRepositoryBranches(options: { repoId: string })`. Each delegates to the corresponding API layer function. Define explicit Options interfaces for each.",
        "AC-8: Create MCP tool files for read endpoints: src/mcp/tools/get-scm-repositories.ts (tool name: get_scm_repositories, schema: { filter: z.string().optional().describe(\"RSQL filter. Supported keys: repositoryId, projectId. Operator: =in= only\") }, annotations: { readOnlyHint: true, openWorldHint: true }), src/mcp/tools/get-scm-repository.ts (tool name: get_scm_repository, schema: { repo_id: z.string(), include: z.string().optional().describe(\"Set to 'defaultBranchName' to include default branch\") }, annotations: { readOnlyHint: true, openWorldHint: true }), src/mcp/tools/get-scm-repository-branches.ts (tool name: get_scm_repository_branches, schema: { repo_id: z.string() }, annotations: { readOnlyHint: true, openWorldHint: true }). All schemas are plain Zod objects (NOT z.object()).",
        "AC-9: Create MCP tool files for write endpoints: src/mcp/tools/create-scm-repository.ts (tool name: create_scm_repository, schema: { project_id: z.string(), repository_url: z.string(), scm_provider: z.string().describe(\"SCM provider enum value\"), application_id: z.string().optional(), auth_name: z.string().optional(), auth_mode: z.string().optional().describe(\"PAT or OAUTH_2\"), auth_token: z.string().optional(), auth_email: z.string().optional() }, annotations: { readOnlyHint: false, openWorldHint: true }), src/mcp/tools/update-scm-repository.ts (tool name: update_scm_repository, schema: { repo_id: z.string(), project_id: z.string().optional(), application_id: z.string().optional(), repository_url: z.string().optional(), scm_provider: z.string().optional() }, annotations: { readOnlyHint: false, openWorldHint: true }), src/mcp/tools/test-scm-repo-connection.ts (tool name: test_scm_repo_connection, schema: { project_id: z.string(), repository_url: z.string(), scm_provider: z.string() }, annotations: { readOnlyHint: false, openWorldHint: true }). All schemas are plain Zod objects.",
        "AC-10: Register all 6 new tools in src/mcp/tools/index.ts by importing them and adding to the tools array.",
        "AC-11: All files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 2,
      "passes": true,
      "notes": "Depends on PRD-R1. The list endpoints (getRepositories, getRepositoryBranches) use getAllOffset() for automatic offset-based pagination. Single-item GET (getRepository) uses client.get(). POST/PATCH use client.fetch(). Tool handlers use jsonResponse(data) and errorResponse(message) from src/mcp/types.ts. The ScmRepositoryWithBranch response body is nested inside a `body` wrapper per spec line 3089.",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:36:08Z"
    },
    {
      "id": "PRD-R3",
      "title": "SCM providers, groups, repositories, projects, and group auth endpoints",
      "description": "Implement the 6 endpoints for provider-level and SCM-level discovery: list SCM providers, test SCM connection with PAT, list SCM groups, list SCM remote repositories, list SCM projects by group (Azure only), and create group authentication. Several of these require custom headers (X-Polaris-SCM-PAT, X-Polaris-SCM-Email).",
      "acceptanceCriteria": [
        "AC-1: In src/api/repos.ts, implement `getProviders(): Promise<ScmProviderInfo[]>` using `client.getAllOffset<ScmProviderInfo>(\"/api/integrations/repos/providers\", undefined, ACCEPT_PROVIDERS_LIST)`. No params required. (spec line 590-636, operationId: listRepoIntegrationsProviders)",
        "AC-2: In src/api/repos.ts, implement `testScmConnection(params: TestScmConnectionParams): Promise<unknown>` against GET /api/integrations/repos/scm/test-connection (spec line 1528-1637, operationId: testReposConnection). TestScmConnectionParams includes required scmProvider (query param), required scmPat (mapped to X-Polaris-SCM-PAT header), optional scmEmail (mapped to X-Polaris-SCM-Email header). Accept: ACCEPT_SCM_CONNECTION. Since this is a GET with custom headers, use client.fetch() with method GET and pass custom headers.",
        "AC-3: In src/api/repos.ts, implement `getScmGroups(params: GetScmGroupsParams): Promise<ScmGroup[]>` against GET /api/integrations/repos/scm/groups (spec line 1638-1781, operationId: listGroupsForRepos). Params include required scmProvider (query), required scmPat (X-Polaris-SCM-PAT header), optional scmEmail (X-Polaris-SCM-Email header), optional cursor (_cursor query), optional limit (_limit query), optional topLevelOnly (query). Accept: ACCEPT_SCM_GROUPS. This endpoint uses cursor-based pagination; use client.fetch() with method GET and manually handle pagination or return the first page.",
        "AC-4: In src/api/repos.ts, implement `getScmRemoteRepos(params: GetScmRemoteReposParams): Promise<ScmRemoteRepository[]>` against GET /api/integrations/repos/scm (spec line 1782-1940, operationId: listRepos). Params include optional scmProvider, groupName, projectName, repoSearchTerm, includeSubGroups (query params), required scmPat (header), optional scmEmail (header), optional cursor, limit. Accept: ACCEPT_SCM_REPOS. Uses cursor-based pagination.",
        "AC-5: In src/api/repos.ts, implement `getScmProjects(params: GetScmProjectsParams): Promise<ScmProject[]>` against GET /api/integrations/repos/scm/groups/{groupName}/projects (spec line 1941-2057, operationId: listProjectsByGroup). Params include required groupName (path), optional scmProvider (query), required scmPat (x-polaris-scm-pat header), optional cursor, limit. Accept: ACCEPT_SCM_PROJECTS. Azure-only endpoint.",
        "AC-6: In src/api/repos.ts, implement `createGroupAuth(params: CreateGroupAuthParams): Promise<void>` using `client.fetch<void>(\"/api/integrations/repos/scm/groups/auth\", { method: \"POST\", body, accept: ACCEPT_GROUPS_AUTH, contentType: ACCEPT_GROUPS_AUTH })`. CreateGroupAuthParams includes required applicationId, scmProvider, and optional scmAuthentication ({ name?, authenticationMode?, authToken?, email? }), groupUrl. Returns 201 (no body). (spec line 504-589, operationId: createGroupAuthenticationForRepo)",
        "AC-7: In src/services/repos.ts, implement corresponding service functions with options objects: `getScmProviders()`, `testScmProviderConnection(options: { scmProvider: string; scmPat: string; scmEmail?: string })`, `getScmProviderGroups(options: { scmProvider: string; scmPat: string; scmEmail?: string; topLevelOnly?: boolean })`, `getScmProviderRepositories(options: { scmPat: string; scmProvider?: string; groupName?: string; projectName?: string; repoSearchTerm?: string; includeSubGroups?: boolean; scmEmail?: string })`, `getScmProviderProjects(options: { groupName: string; scmPat: string; scmProvider?: string })`, `createScmGroupAuth(options: { applicationId: string; scmProvider: string; authName?: string; authMode?: string; authToken?: string; authEmail?: string; groupUrl?: string })`. Define explicit Options interfaces for each.",
        "AC-8: Create MCP tool files for read endpoints: src/mcp/tools/get-scm-providers.ts (tool name: get_scm_providers, schema: {}, annotations: { readOnlyHint: true, openWorldHint: true }), src/mcp/tools/get-scm-groups.ts (tool name: get_scm_groups, schema: { scm_provider: z.string(), scm_pat: z.string().describe(\"Personal Access Token for SCM provider\"), scm_email: z.string().optional().describe(\"Required for Bitbucket Cloud\"), top_level_only: z.boolean().optional().describe(\"GitLab only: fetch only top-level groups\") }, annotations: { readOnlyHint: true, openWorldHint: true }), src/mcp/tools/get-scm-remote-repos.ts (tool name: get_scm_remote_repos, schema: { scm_pat: z.string(), scm_provider: z.string().optional(), scm_email: z.string().optional(), group_name: z.string().optional(), project_name: z.string().optional(), repo_search_term: z.string().optional(), include_sub_groups: z.boolean().optional().describe(\"GitLab only: include repos from sub-groups\") }, annotations: { readOnlyHint: true, openWorldHint: true }), src/mcp/tools/get-scm-projects.ts (tool name: get_scm_projects, schema: { group_name: z.string(), scm_pat: z.string(), scm_provider: z.string().optional() }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-9: Create MCP tool files for write endpoints: src/mcp/tools/test-scm-provider-connection.ts (tool name: test_scm_provider_connection, schema: { scm_provider: z.string(), scm_pat: z.string(), scm_email: z.string().optional() }, annotations: { readOnlyHint: false, openWorldHint: true }), src/mcp/tools/create-scm-group-auth.ts (tool name: create_scm_group_auth, schema: { application_id: z.string(), scm_provider: z.string(), auth_name: z.string().optional(), auth_mode: z.string().optional().describe(\"PAT or OAUTH_2\"), auth_token: z.string().optional(), auth_email: z.string().optional(), group_url: z.string().optional() }, annotations: { readOnlyHint: false, openWorldHint: true }).",
        "AC-10: Register all 6 new tools in src/mcp/tools/index.ts.",
        "AC-11: All files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 2,
      "passes": true,
      "notes": "Depends on PRD-R1. Several endpoints require custom headers (X-Polaris-SCM-PAT, X-Polaris-SCM-Email) which are not standard Polaris API auth headers. The API layer will need to pass these via client.fetch() custom headers option. The SCM groups and repos endpoints use cursor-based pagination (_cursor, not _offset). If PolarisClient does not support cursor pagination natively, the API functions should accept cursor/limit params and return a single page, or implement manual cursor iteration. The listProjectsByGroup endpoint is Azure-only (spec line 1946).",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:40:25Z"
    },
    {
      "id": "PRD-R4",
      "title": "Bulk repository import and status tracking",
      "description": "Implement the 2 bulk repo import endpoints: initiate a bulk repo import job (POST) and get import groups status (GET paginated). These allow importing SCM repositories in bulk for a given group/application and monitoring their import progress.",
      "acceptanceCriteria": [
        "AC-1: In src/api/repos.ts, implement `importReposForGroup(params: ImportReposForGroupParams): Promise<{ location: string }>` using `client.fetch()` with method POST against /api/integrations/repos/bulk-repo-import (spec line 648-851, operationId: importReposForAGroup). Content-Type: ACCEPT_BULK_REPO_IMPORT. Requires custom headers: X-Polaris-SCM-PAT (required) and X-Polaris-SCM-Email (optional). Returns 202 with Location header containing the job status URL. ImportReposForGroupParams includes required applicationId, scmProvider, scmPat, and optional scmEmail, policySettings ({ issuePolicyIds?, scanPolicyIds? }), repositories (array of { groupName, allRepositoriesInGroup, includeRepositories?, excludeRepositories? }), nestedRepositories (for Azure).",
        "AC-2: In src/api/repos.ts, implement `getRepoImportGroupsStatus(params?: GetRepoImportGroupsStatusParams): Promise<BulkRepoImportGroupStatus[]>` using `client.getAllOffset<BulkRepoImportGroupStatus>(\"/api/integrations/repos/bulk-repo-import/groups/status\", queryParams, ACCEPT_BULK_REPO_IMPORT_GROUPS_STATUS)`. GetRepoImportGroupsStatusParams has optional `filter` field mapped to `_filter` query param. Supports filtering by state (NOT_STARTED, IN_PROGRESS, FAILED, COMPLETED) and portfolioItemId. (spec line 852-971, operationId: getReposImportGroupsStatus)",
        "AC-3: In src/services/repos.ts, implement `bulkImportRepos(options: BulkImportReposOptions)` and `getBulkRepoImportGroupsStatus(options?: { filter?: string })` service functions. BulkImportReposOptions includes applicationId, scmProvider, scmPat, and optional scmEmail, policySettings, repositories. Service delegates to API layer.",
        "AC-4: Create MCP tool: src/mcp/tools/bulk-import-repos.ts (tool name: bulk_import_repos, schema: { application_id: z.string(), scm_provider: z.string(), scm_pat: z.string(), scm_email: z.string().optional().describe(\"Required for Bitbucket Cloud\"), repositories: z.string().describe(\"JSON array of repository selections: [{ groupName: string, allRepositoriesInGroup: boolean, includeRepositories?: string[], excludeRepositories?: string[] }]\"), issue_policy_ids: z.string().optional().describe(\"Comma-separated issue policy UUIDs\"), scan_policy_ids: z.string().optional().describe(\"Comma-separated scan policy UUIDs\") }, annotations: { readOnlyHint: false, openWorldHint: true }). Handler must JSON.parse the repositories string and split comma-separated policy IDs.",
        "AC-5: Create MCP tool: src/mcp/tools/get-bulk-repo-import-groups-status.ts (tool name: get_bulk_repo_import_groups_status, schema: { filter: z.string().optional().describe(\"RSQL filter. Keys: state, portfolioItemId. Example: state==COMPLETED\") }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-6: Register both new tools in src/mcp/tools/index.ts.",
        "AC-7: All files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 2,
      "passes": true,
      "notes": "Depends on PRD-R1. The POST /bulk-repo-import returns HTTP 202 with a Location header (not a JSON body). The API function must extract the Location header from the response. This may require using client.fetch() in a way that provides access to response headers. The repositories param in the MCP tool is a JSON string that gets parsed to the complex nested structure in the handler. Policy IDs are comma-separated strings that get split into arrays.",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:44:30Z"
    },
    {
      "id": "PRD-R5",
      "title": "Bulk group import and job management",
      "description": "Implement the 5 bulk group import endpoints: initiate bulk group+repo import (POST), update/abort an import job (PATCH), get job status by ID (GET), get all job statuses (GET paginated), and list groups status (GET paginated - already in PRD-R4 for repo-level, this is job-level). These manage the full lifecycle of bulk group import jobs.",
      "acceptanceCriteria": [
        "AC-1: In src/api/repos.ts, implement `importGroupsRepos(params: ImportGroupsReposParams): Promise<{ location: string }>` using `client.fetch()` with method POST against /api/integrations/repos/bulk-group-import (spec line 972-1195, operationId: importGroupsRepos). Content-Type: ACCEPT_BULK_GROUP_IMPORT. Requires custom headers: X-Polaris-SCM-PAT (required), X-Polaris-SCM-Email (optional). Returns 202 with Location header. ImportGroupsReposParams includes required scmProvider, scmPat, and optional scmEmail, automaticMapping (boolean), policySettings, roleUsersMappings (array of { roleId, userId }), repositorySelections (array of { applicationName?, applicationNameTemplate?, repositories?, nestedRepositories? }).",
        "AC-2: In src/api/repos.ts, implement `updateGroupImportJob(params: UpdateGroupImportJobParams): Promise<BulkGroupImportUpdateResponse>` using `client.fetch<BulkGroupImportUpdateResponse>(\"/api/integrations/repos/bulk-group-import/${params.jobId}\", { method: \"PATCH\", body: { action: params.action }, accept: ACCEPT_BULK_GROUP_IMPORT, contentType: ACCEPT_BULK_GROUP_IMPORT })`. UpdateGroupImportJobParams has required jobId and action (only \"ABORT\" is valid). (spec line 1196-1290, operationId: updateImportGroupsReposJob)",
        "AC-3: In src/api/repos.ts, implement `getGroupImportJobStatus(jobId: string): Promise<BulkGroupImportJobStatus>` using `client.get<BulkGroupImportJobStatus>(\"/api/integrations/repos/bulk-group-import/${jobId}/status\", undefined, ACCEPT_BULK_GROUP_IMPORT_STATUS)`. (spec line 1291-1368, operationId: getGroupsReposImportStatusById)",
        "AC-4: In src/api/repos.ts, implement `getAllGroupImportStatuses(params?: GetAllGroupImportStatusesParams): Promise<BulkGroupImportJobStatus[]>` using `client.getAllOffset<BulkGroupImportJobStatus>(\"/api/integrations/repos/bulk-group-import/status\", queryParams, ACCEPT_BULK_GROUP_IMPORT_STATUS)`. GetAllGroupImportStatusesParams has optional `filter` mapped to `_filter`. Supports filtering by state (NOT_STARTED, IN_PROGRESS, FAILED, ABORTED, TIMED_OUT, PARTIALLY_COMPLETED, COMPLETED). (spec line 1369-1527, operationId: getAllGroupsReposImportStatus)",
        "AC-5: In src/services/repos.ts, implement service functions: `bulkImportGroups(options: BulkImportGroupsOptions)` (delegates to importGroupsRepos), `abortGroupImportJob(options: { jobId: string })` (delegates to updateGroupImportJob with action ABORT), `getGroupImportJobStatus(jobId: string)` (delegates to API), `getAllGroupImportStatuses(options?: { filter?: string })` (delegates to API). Define explicit Options interfaces.",
        "AC-6: Create MCP tool: src/mcp/tools/bulk-import-groups.ts (tool name: bulk_import_groups, schema: { scm_provider: z.string(), scm_pat: z.string(), scm_email: z.string().optional().describe(\"Required for Bitbucket Cloud\"), automatic_mapping: z.boolean().optional().describe(\"Auto-map groups to applications\"), repository_selections: z.string().describe(\"JSON array of repository selections with application mappings\"), issue_policy_ids: z.string().optional().describe(\"Comma-separated issue policy UUIDs\"), scan_policy_ids: z.string().optional().describe(\"Comma-separated scan policy UUIDs\") }, annotations: { readOnlyHint: false, openWorldHint: true }).",
        "AC-7: Create MCP tool: src/mcp/tools/abort-group-import-job.ts (tool name: abort_group_import_job, schema: { job_id: z.string() }, annotations: { readOnlyHint: false, openWorldHint: true }).",
        "AC-8: Create MCP tool: src/mcp/tools/get-group-import-job-status.ts (tool name: get_group_import_job_status, schema: { job_id: z.string() }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-9: Create MCP tool: src/mcp/tools/get-all-group-import-statuses.ts (tool name: get_all_group_import_statuses, schema: { filter: z.string().optional().describe(\"RSQL filter. Key: state. Values: NOT_STARTED, IN_PROGRESS, FAILED, ABORTED, TIMED_OUT, PARTIALLY_COMPLETED, COMPLETED\") }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-10: Register all 4 new tools in src/mcp/tools/index.ts.",
        "AC-11: All files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 2,
      "passes": true,
      "notes": "Depends on PRD-R1. The PATCH endpoint for aborting a job only supports action=ABORT (spec line 3411-3417). The abort service function should hardcode this value. Both POST endpoints return 202 with Location header, no JSON body. Complex nested body structures (repositorySelections, roleUsersMappings) are passed as JSON strings in MCP tool schemas and parsed in the tool handler. The email field for the import request is in the request body for UpdatedImportRepositoriesRequestV1 (spec line 3394-3400), while headers carry X-Polaris-SCM-PAT and X-Polaris-SCM-Email.",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:48:33Z"
    },
    {
      "id": "PRD-R6",
      "title": "Groups settings, connection testing, and mapping status",
      "description": "Implement the 4 groups settings endpoints: update group sync settings (PATCH), get group settings (GET paginated), test group connection (POST), and get group mapping status (GET paginated). These manage repository synchronization and auto-onboarding settings at the application/group level.",
      "acceptanceCriteria": [
        "AC-1: In src/api/repos.ts, implement `updateGroupSettings(params: UpdateGroupSettingsParams): Promise<void>` using `client.fetch<void>(\"/api/integrations/repos/groups-settings\", { method: \"PATCH\", body, contentType: ACCEPT_GROUPS_SETTINGS_UPDATE })`. Returns 202 (no body). Body includes required applicationId and settings object with repository sub-object ({ importNewRepositories?, syncReposAndBranches?, automaticallyTestCodeChanges? }) and branch sub-object ({ importNewBranches?, branchNameExpressions? }). (spec line 2058-2117, operationId: groupSettings)",
        "AC-2: In src/api/repos.ts, implement `getGroupSettings(params?: GetGroupSettingsParams): Promise<GroupsSettings[]>` using `client.getAllOffset<GroupsSettings>(\"/api/integrations/repos/groups-settings\", queryParams, ACCEPT_GROUPS_SETTINGS)`. GetGroupSettingsParams has optional `filter` mapped to `_filter`. Supports filtering by applicationId and groupId with =in= operator. (spec line 2118-2219, operationId: getGroupSettings)",
        "AC-3: In src/api/repos.ts, implement `testGroupConnection(params: TestGroupConnectionParams): Promise<void>` using `client.fetch<void>(\"/api/integrations/repos/groups-settings/connection\", { method: \"POST\", body, contentType: ACCEPT_GROUP_CONNECTION_REQUEST })`. Requires custom header X-Polaris-SCM-PAT. Body includes repositoryUrl, scmProvider, and optional email. Returns 200 (no body). (spec line 2220-2310, operationId: groupSettingsConnection)",
        "AC-4: In src/api/repos.ts, implement `getGroupMappingStatus(params: GetGroupMappingStatusParams): Promise<GroupMappingStatus[]>` using `client.getAllOffset<GroupMappingStatus>(\"/api/integrations/repos/group-mapping-status\", queryParams, ACCEPT_GROUP_MAPPING_STATUS)`. GetGroupMappingStatusParams has required applicationId (query param) and optional projectId (query param). (spec line 2311-2396, operationId: groupMappingStatus)",
        "AC-5: In src/services/repos.ts, implement service functions: `updateScmGroupSettings(options: UpdateScmGroupSettingsOptions)` (with applicationId, importNewRepositories?, syncReposAndBranches?, automaticallyTestCodeChanges?, importNewBranches?, branchNameExpressions?), `getScmGroupSettings(options?: { filter?: string })`, `testScmGroupConnection(options: { repositoryUrl: string; scmProvider: string; scmPat: string; email?: string })`, `getScmGroupMappingStatus(options: { applicationId: string; projectId?: string })`. Define explicit Options interfaces.",
        "AC-6: Create MCP tool: src/mcp/tools/update-scm-group-settings.ts (tool name: update_scm_group_settings, schema: { application_id: z.string(), import_new_repositories: z.boolean().optional(), sync_repos_and_branches: z.boolean().optional(), automatically_test_code_changes: z.boolean().optional(), import_new_branches: z.boolean().optional(), branch_name_expressions: z.string().optional().describe(\"Comma-separated branch name expressions\") }, annotations: { readOnlyHint: false, openWorldHint: true }). Handler splits branch_name_expressions by comma into array.",
        "AC-7: Create MCP tool: src/mcp/tools/get-scm-group-settings.ts (tool name: get_scm_group_settings, schema: { filter: z.string().optional().describe(\"RSQL filter. Keys: applicationId, groupId. Operator: =in= only\") }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-8: Create MCP tool: src/mcp/tools/test-scm-group-connection.ts (tool name: test_scm_group_connection, schema: { repository_url: z.string().describe(\"SCM group URL\"), scm_provider: z.string(), scm_pat: z.string(), email: z.string().optional().describe(\"Required for Bitbucket Cloud\") }, annotations: { readOnlyHint: false, openWorldHint: true }).",
        "AC-9: Create MCP tool: src/mcp/tools/get-scm-group-mapping-status.ts (tool name: get_scm_group_mapping_status, schema: { application_id: z.string(), project_id: z.string().optional() }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-10: Register all 4 new tools in src/mcp/tools/index.ts.",
        "AC-11: All files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 2,
      "passes": true,
      "notes": "Depends on PRD-R1. The PATCH groups-settings returns 202 with no body. The POST groups-settings/connection returns 200 with no body. Both should return void from the API layer. The group-mapping-status Accept header notably lacks the ;charset=UTF-8 suffix (spec line 2361: application/vnd.polaris.integrations.repos.group-mapping-status-1+json). The GroupsSettingsRequest body has a nested structure with settings.repository and settings.branch sub-objects (spec line 3339-3376).",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:51:40Z"
    },
    {
      "id": "PRD-R7",
      "title": "Test settings management (create, get, delete)",
      "description": "Implement the 3 test settings endpoints: create test settings (POST), get test settings by scope (GET), and delete test settings by scope (DELETE). These manage test automation synchronization settings at organization, application, project, or branch scope levels.",
      "acceptanceCriteria": [
        "AC-1: In src/api/repos.ts, implement `createTestSettings(params: CreateTestSettingsParams): Promise<void>` using `client.fetch<void>(\"/api/integrations/repos/test-settings\", { method: \"POST\", body, contentType: ACCEPT_TEST_SETTINGS_CREATE })`. Returns 202 (no body). Body includes required scope (enum: organization, application, project, branch), required scopeId, and testSyncSettings ({ branch: { default: { pullRequestMerged?, assessmentTypes? }, nonDefault: { pullRequestMerged?, assessmentTypes? } } }). (spec line 2397-2451, operationId: createTestSettings)",
        "AC-2: In src/api/repos.ts, implement `getTestSettings(params: GetTestSettingsParams): Promise<TestSettingsResponse>` using `client.get<TestSettingsResponse>(\"/api/integrations/repos/test-settings/${params.scopeId}\", { scope: params.scope }, ACCEPT_TEST_SETTINGS)`. GetTestSettingsParams has required scopeId (path param) and required scope (query param: organization | application | project | branch). (spec line 2452-2521, operationId: getTestSettings)",
        "AC-3: In src/api/repos.ts, implement `deleteTestSettings(params: DeleteTestSettingsParams): Promise<void>` using `client.fetch<void>(\"/api/integrations/repos/test-settings/${params.scopeId}\", { method: \"DELETE\" })`. Pass scope as query param. DeleteTestSettingsParams has required scopeId and required scope. Returns 200 (no body). (spec line 2522-2586, operationId: deleteTestSettings)",
        "AC-4: In src/services/repos.ts, implement service functions: `createScmTestSettings(options: CreateScmTestSettingsOptions)` (with scope, scopeId, pullRequestMergedDefault?, assessmentTypesDefault?, pullRequestMergedNonDefault?, assessmentTypesNonDefault?), `getScmTestSettings(options: { scopeId: string; scope: string })`, `deleteScmTestSettings(options: { scopeId: string; scope: string })`. The create service constructs the nested testSyncSettings body from flat options. Define explicit Options interfaces.",
        "AC-5: Create MCP tool: src/mcp/tools/create-scm-test-settings.ts (tool name: create_scm_test_settings, schema: { scope: z.enum([\"organization\", \"application\", \"project\", \"branch\"]).describe(\"Scope level for test settings\"), scope_id: z.string().describe(\"UUID of the scope resource (org ID, app ID, project ID, or branch ID)\"), pull_request_merged_default: z.boolean().optional().describe(\"Trigger test when PR merged on default branch\"), assessment_types_default: z.string().optional().describe(\"Comma-separated assessment types for default branch, e.g. SAST,SCA\"), pull_request_merged_non_default: z.boolean().optional().describe(\"Trigger test when PR merged on non-default branch\"), assessment_types_non_default: z.string().optional().describe(\"Comma-separated assessment types for non-default branches\") }, annotations: { readOnlyHint: false, openWorldHint: true }). Handler splits comma-separated assessment types into arrays and constructs the nested testSyncSettings body.",
        "AC-6: Create MCP tool: src/mcp/tools/get-scm-test-settings.ts (tool name: get_scm_test_settings, schema: { scope_id: z.string(), scope: z.enum([\"organization\", \"application\", \"project\", \"branch\"]) }, annotations: { readOnlyHint: true, openWorldHint: true }).",
        "AC-7: Create MCP tool: src/mcp/tools/delete-scm-test-settings.ts (tool name: delete_scm_test_settings, schema: { scope_id: z.string(), scope: z.enum([\"organization\", \"application\", \"project\", \"branch\"]) }, annotations: { readOnlyHint: false, destructiveHint: true, openWorldHint: true }). The delete tool MUST include destructiveHint: true.",
        "AC-8: Register all 3 new tools in src/mcp/tools/index.ts.",
        "AC-9: All files pass `deno task check`, `deno task lint`, and `deno fmt --check` with zero errors."
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-R1. The delete tool must include destructiveHint: true in its annotations per project convention for destructive operations. The test-settings Accept header lacks ;charset=UTF-8 (spec line 2486: application/vnd.polaris.integrations.repos.test-settings+json). The testSyncSettings body is nested: testSyncSettings.branch.default and testSyncSettings.branch.nonDefault each have pullRequestMerged (boolean) and assessmentTypes (string[]) fields (spec line 2804-2845). The create service function should construct this nested structure from the flat options.",
      "claimed_by": "agent-2",
      "claimed_at": "2026-02-19T21:54:46Z"
    }
  ]
}
