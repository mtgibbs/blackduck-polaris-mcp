{
  "project": "blackduck-polaris-mcp",
  "branchName": "ralph/findings-api",
  "description": "Implement the complete Findings API for the Black Duck Polaris MCP server. 35 non-deprecated endpoints across issues, occurrences, taxonomy, component versions, and component origins.",
  "userStories": [
    {
      "id": "PRD-F1",
      "title": "Fix shared types and existing issue endpoint gaps",
      "description": "Fix type definitions in polaris.ts that are incorrect or incomplete, and update existing get_issues/get_issue tools to pass missing _include* query parameters. This must complete first because all other stories depend on correct shared types.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: TriageAuthor.id field changed from required to optional (`id?: string`)",
        "In src/types/polaris.ts: AssistResponse fields summary, codeAnalysis, analysis changed to optional (with ?), suggestedFix remains string | null but also optional",
        "In src/types/polaris.ts: IssueContext interface cleaned up to match spec (remove extra tenantId and _links if present)",
        "In src/services/findings.ts: GetIssuesOptions includes includeIssueExclusion, includeExtensionProperties, includeComponentLocations and passes them to API",
        "In src/services/findings.ts: GetIssueOptions includes includeIssueExclusion, includeExtensionProperties and passes them to API",
        "In src/mcp/tools/get-issues.ts: Add optional schema fields for include_issue_exclusion, include_extension_properties, include_component_locations wired to service",
        "In src/mcp/tools/get-issue.ts: Add optional schema fields for include_issue_exclusion, include_extension_properties wired to service",
        "Reference specs/findings.yaml for the canonical Issue, IssueContext, AssistResponse, and TriageAuthor schemas",
        "`deno task check` passes with no type errors",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "Foundation story — must complete before all others. Changes affect Issue, AssistResponse, TriageAuthor used across many endpoints.",
      "claimed_by": "agent-1",
      "claimed_at": "2026-02-19T17:18:37Z"
    },
    {
      "id": "PRD-F2",
      "title": "Implement issue triage-history and detection-history endpoints",
      "description": "Add two new read-only GET endpoints: (1) GET /api/findings/issues/{id}/triage-history — paginated triage transactions with latestAuthor, latestTimestamp, triageProperties. (2) GET /api/findings/issues/{id}/detection-history — detection events (FIRST_DETECTED, ABSENT, DETECTED_AGAIN). Both use Accept: application/vnd.polaris.findings.issues-1+json.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add DetectionEventType = 'FIRST_DETECTED' | 'ABSENT' | 'DETECTED_AGAIN'",
        "In src/types/polaris.ts: Add DetectionHistoryEvent interface with eventType and date",
        "In src/types/polaris.ts: Add DetectionHistory interface with history array",
        "In src/types/polaris.ts: Add TriageHistoryTransaction interface with latestAuthor, latestTimestamp, triageProperties",
        "In src/api/findings.ts: Add getIssueTriageHistory() — cursor-paginated via getAllCursor",
        "In src/api/findings.ts: Add getIssueDetectionHistory() — single object via client.get (NOT paginated)",
        "In src/services/findings.ts: Add corresponding service functions",
        "Create src/mcp/tools/get-issue-triage-history.ts with tool get_issue_triage_history (issue_id required, scoping params optional, max_results optional)",
        "Create src/mcp/tools/get-issue-detection-history.ts with tool get_issue_detection_history (issue_id required, scoping params optional)",
        "Register both tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml sections: updatedTaxonomyGetIssueTriageHistory, updatedTaxonomyGetIssueDetectionHistory",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-F1. TriageHistoryTransaction type is reused by PRD-F10 (component version triage history).",
      "claimed_by": "agent-3",
      "claimed_at": "2026-02-19T17:18:38Z"
    },
    {
      "id": "PRD-F3",
      "title": "Implement issue triage action and issue count endpoints",
      "description": "Add: (1) POST /api/findings/issues/_actions/triage — bulk triage with filter + triageProperties, returns {count}. (2) GET /api/findings/issues/_actions/count — aggregation with _group param, returns grouped counts. Both use Accept: issues-1+json.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add TriageRequest interface with filter and triageProperties array",
        "In src/types/polaris.ts: Add TriageResult interface with count and _type",
        "In src/types/polaris.ts: Add IssueCountGroup interface with key, value fields",
        "In src/types/polaris.ts: Add IssueCountItem interface with group array, count, averageAgeInDays",
        "In src/api/findings.ts: Add triageIssues() — POST with body, scoping query params, returns TriageResult",
        "In src/api/findings.ts: Add getIssueCount() — GET with _group, _includeAverageAge, cursor pagination",
        "In src/services/findings.ts: Add corresponding service functions",
        "Create src/mcp/tools/triage-issues.ts with tool triage_issues (readOnlyHint: false)",
        "Create src/mcp/tools/get-issue-count.ts with tool get_issue_count (readOnlyHint: true)",
        "Register both tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml sections: updatedTaxonomyUpdateIssue, updatedTaxonomyGetIssueCount",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Depends on PRD-F1. TriageResult type reused by PRD-F10. Triage keys: comment, status, dismissal-reason, is-dismissed, owner, fix-by.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T17:22:00Z"
    },
    {
      "id": "PRD-F4",
      "title": "Implement issue export and count-over-time endpoints",
      "description": "Add: (1) GET /api/findings/issues/_actions/export — JSON export of issues. (2) GET /api/findings/issues/_actions/count-over-time — time series data with _lastXDays or _fromDate/_toDate.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add IssueExportItem interface with type, severity, location, fileName, toolType, etc.",
        "In src/types/polaris.ts: Add IssueCountOverTimeEntry interface with detectedCount, absentCount, date, toolType, toolId",
        "In src/types/polaris.ts: Add IssueCountOverTimeResponse interface with issuesOverTime array",
        "In src/api/findings.ts: Add exportIssues() — GET, returns IssueExportItem array",
        "In src/api/findings.ts: Add getIssueCountOverTime() — GET, returns IssueCountOverTimeResponse (NOT paginated, use client.get)",
        "In src/services/findings.ts: Add corresponding service functions",
        "Create src/mcp/tools/export-findings-issues.ts with tool export_findings_issues (NOT export_issues — avoids collision with bug-tracking tool)",
        "Create src/mcp/tools/get-issue-count-over-time.ts with tool get_issue_count_over_time, validates mutual exclusivity of last_x_days vs from_date/to_date",
        "Register both tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml sections: updatedTaxonomyExportIssues, updatedTaxonomyGetIssueCountOverTime",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Depends on PRD-F1. count-over-time is NOT paginated — returns a single response object.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T17:26:31Z"
    },
    {
      "id": "PRD-F5",
      "title": "Implement issue pending approval endpoints",
      "description": "Add: (1) POST /api/findings/issues/_actions/change-pending-fix-by — approve/reject fix-by changes. (2) POST /api/findings/issues/_actions/change-pending-status — approve/reject status changes. Both require projectId, accept body {ids, action, comment?}, return 204.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add PendingApprovalAction = 'approved' | 'rejected'",
        "In src/types/polaris.ts: Add PendingApprovalRequest interface with ids string array, action, optional comment",
        "In src/api/findings.ts: Add Content-Type constants for each endpoint's unique vendor media type",
        "In src/api/findings.ts: Add changePendingFixBy() and changePendingStatus() — POST, returns void (204)",
        "In src/services/findings.ts: Add corresponding service functions",
        "Create src/mcp/tools/change-pending-fix-by.ts with tool change_pending_fix_by (readOnlyHint: false)",
        "Create src/mcp/tools/change-pending-status.ts with tool change_pending_status (readOnlyHint: false)",
        "Register both tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml sections: updatedTaxonomyUpdatePendingFixBy, updatedTaxonomyUpdatePendingStatus",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Depends on PRD-F1. Uses unique vendor Content-Types: issues-change-pending-fix-by-1+json and issues-change-pending-status-1+json.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T17:29:54Z"
    },
    {
      "id": "PRD-F6",
      "title": "Fix occurrence assist feedback return type and Content-Type",
      "description": "Fix provideAssistFeedback: (1) Return type void → AssistResponse. (2) Content-Type → application/json-patch+json. (3) MCP tool returns actual response instead of {success: true}.",
      "acceptanceCriteria": [
        "In src/api/findings.ts: provideAssistFeedback return type changed to Promise<AssistResponse>",
        "In src/api/findings.ts: PATCH Content-Type changed to 'application/json-patch+json'",
        "In src/services/findings.ts: provideAssistFeedback return type changed to Promise<AssistResponse>",
        "In src/mcp/tools/provide-assist-feedback.ts: Handler returns jsonResponse(result) with the AssistResponse",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Can run in parallel with PRD-F2 through PRD-F5. Only touches occurrence files. Depends on PRD-F1 for AssistResponse optional field fixes.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T17:18:38Z"
    },
    {
      "id": "PRD-F7",
      "title": "Implement taxonomy endpoints",
      "description": "Add 4 read-only taxonomy endpoints: GET /api/findings/taxonomies, GET /api/findings/taxa/{id}, GET /api/findings/taxa/{id}/subtaxa, GET /api/findings/taxa/{id}/issue-types. Uses Accept headers: taxonomies-1+json and taxa-1+json.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add TaxonLocalized interface with name, issueTypeNames, otherDetails",
        "In src/types/polaris.ts: Add Taxon interface with id, subtaxa array, isRoot, _localized",
        "In src/types/polaris.ts: Add Taxonomy interface (same shape as Taxon)",
        "In src/types/polaris.ts: Add TaxonIssueType interface with id, _localized",
        "In src/api/findings.ts: Add ACCEPT_TAXONOMIES and ACCEPT_TAXA constants",
        "In src/api/findings.ts: Add getTaxonomies() with _includeDescendants, _includeOnlyStandards, cursor pagination",
        "In src/api/findings.ts: Add getTaxon(), getTaxonSubtaxa(), getTaxonIssueTypes()",
        "In src/services/findings.ts: Add all four service functions",
        "Create 4 tool files: get-taxonomies.ts, get-taxon.ts, get-taxon-subtaxa.ts, get-taxon-issue-types.ts",
        "Register all four tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml Taxon Query tag for endpoint details",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Depends on PRD-F1. Independent of other groups — can run in parallel after F1.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T17:38:30Z"
    },
    {
      "id": "PRD-F8",
      "title": "Implement component versions read endpoints",
      "description": "Add 3 read endpoints: GET /api/findings/component-versions (list), GET /api/findings/component-versions/{id} (detail), GET /api/findings/component-versions/_actions/count. Accept: component-versions-1+json. Requires projectId.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add SecurityRisk, MatchType type aliases",
        "In src/types/polaris.ts: Add ComponentInfo interface (id, name, description, homePage, openHubPage)",
        "In src/types/polaris.ts: Add LicenseDefinition interface (recursive: single license OR composite with type CONJUNCTIVE|DISJUNCTIVE)",
        "In src/types/polaris.ts: Add ComponentVersion interface with all fields (version, releaseDate, securityRisk, matchTypes, matchScore, usages, component, licenses, triageProperties)",
        "In src/types/polaris.ts: Add ComponentVersionCountItem interface",
        "In src/api/findings.ts: Add ACCEPT_COMPONENT_VERSIONS constant",
        "In src/api/findings.ts: Add getComponentVersions(), getComponentVersion(), getComponentVersionCount()",
        "In src/services/findings.ts: Add all three service functions",
        "Create 3 tool files: get-component-versions.ts, get-component-version.ts, get-component-version-count.ts",
        "Register all three tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml Component Version Query tag",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Depends on PRD-F1. Blocks PRD-F9, F10, F11. ComponentVersion and MatchType types reused by downstream stories.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T18:00:50Z"
    },
    {
      "id": "PRD-F9",
      "title": "Implement component versions write endpoints",
      "description": "Add 5 write/management endpoints: POST add, POST edit, POST reset, DELETE, GET operation-status. All use component-versions-1+json.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add ComponentVersionModifyRequest, ComponentVersionModifyResponse, OperationStatus interfaces",
        "In src/api/findings.ts: Add addComponentVersion(), editComponentVersion(), resetComponentVersion(), deleteComponentVersion(), getOperationStatus()",
        "In src/services/findings.ts: Add all five service functions",
        "Create 5 tool files: add-component-version.ts, edit-component-version.ts, reset-component-version.ts, delete-component-version.ts (destructiveHint: true), get-operation-status.ts",
        "Register all five tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml Component Version Query tag for add/edit/reset/delete/operation-status",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Depends on PRD-F1 and PRD-F8 (shared types and ACCEPT constant). Delete tool uses destructiveHint: true.",
      "claimed_by": "agent-4",
      "claimed_at": "2026-02-19T18:07:10Z"
    },
    {
      "id": "PRD-F10",
      "title": "Implement component version licenses, activity-log, triage-history, and triage",
      "description": "Add 4 endpoints: POST license-definition, GET activity-log, GET triage-history, PATCH triage. Reuses TriageHistoryTransaction from PRD-F2 and TriageResult from PRD-F3.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add ActivityLogEntry interface with actionType, from/to component details, timestamp, comment",
        "In src/types/polaris.ts: Add LicenseDefinitionResponse interface",
        "In src/api/findings.ts: Add assignComponentVersionLicense(), getComponentVersionActivityLog(), getComponentVersionTriageHistory(), triageComponentVersions()",
        "In src/services/findings.ts: Add all four service functions",
        "Create 4 tool files: assign-component-version-license.ts, get-component-version-activity-log.ts, get-component-version-triage-history.ts, triage-component-versions.ts",
        "Register all four tools in src/mcp/tools/index.ts",
        "CV triage uses PATCH (not POST) and keys are 'comment' and 'ignored' (different from issue triage)",
        "Reference specs/findings.yaml Component Version Query tag",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": "Depends on PRD-F1, PRD-F2 (TriageHistoryTransaction), PRD-F3 (TriageResult), PRD-F8 (ACCEPT_COMPONENT_VERSIONS)."
    },
    {
      "id": "PRD-F11",
      "title": "Implement component origins endpoints",
      "description": "Add 3 read-only endpoints: GET /api/findings/component-origins (list), GET /api/findings/component-origins/{id} (detail with upgradeGuidance), GET /api/findings/component-origins/{id}/matches (dependency paths). Accept: component-origins-1+json.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add SecurityRiskCounts interface (critical, high, medium, low counts)",
        "In src/types/polaris.ts: Add UpgradeGuidanceTarget, UpgradeGuidance, TransitiveUpgradeGuidance interfaces",
        "In src/types/polaris.ts: Add ComponentOrigin interface with id, componentId, externalNamespace, externalId, packageUrl, securityRisk, upgradeGuidance, transitiveUpgradeGuidance",
        "In src/types/polaris.ts: Add ComponentOriginMatch interface with id, matchType (reuses MatchType from PRD-F8), externalIds, fileUri",
        "In src/api/findings.ts: Add ACCEPT_COMPONENT_ORIGINS constant",
        "In src/api/findings.ts: Add getComponentOrigins(), getComponentOrigin(), getComponentOriginMatches()",
        "In src/services/findings.ts: Add all three service functions",
        "Create 3 tool files: get-component-origins.ts, get-component-origin.ts, get-component-origin-matches.ts",
        "Register all three tools in src/mcp/tools/index.ts",
        "Reference specs/findings.yaml Component Origin Query tag",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": "Depends on PRD-F1 and PRD-F8 (MatchType type alias). Component origins are SCA-specific — package provenance, security risk, and upgrade guidance."
    }
  ]
}
