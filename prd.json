{
  "project": "blackduck-polaris-mcp",
  "branchName": "ralph/tools-api",
  "description": "Implement the complete Tools API for the Black Duck Polaris MCP server. This is a greenfield implementation with no existing files. Create src/api/tools.ts, src/services/tools.ts, add export to src/services/index.ts, and implement 13 MCP tools across 4 stories covering tool listing/detail, download descriptors, version mapping/matrix, version settings CRUD, and license download. All endpoints use base path /api/tools with vendor media types under application/vnd.polaris.tools.*+json.",
  "userStories": [
    {
      "id": "PRD-TL1",
      "title": "Create API client, service layer, and type definitions for Tools",
      "description": "Establish the greenfield foundation for the Tools API. Create src/api/tools.ts with the PolarisClient integration and media type constants. Create src/services/tools.ts with the service layer. Add the tools service export to src/services/index.ts. Define all TypeScript interfaces in src/types/polaris.ts for the Tools domain. This story produces no MCP tools but is the prerequisite for all subsequent tools stories.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add PolarisTool interface with fields id (string), name (string), type (string), version (string), status (string), beta (boolean), _type (optional string), _links (optional LinkEntry[])",
        "In src/types/polaris.ts: Add DownloadDescriptor interface with fields id (string), filename (string), extension (string), platform (string), hash (string), signedUrl (string), urlExpiresInMillis (number), _type (optional string), _links (optional LinkEntry[])",
        "In src/types/polaris.ts: Add MappedTool interface with fields id (string), type (string), version (string)",
        "In src/types/polaris.ts: Add ToolVersionMapping interface with fields type (string), id (string), version (string), mappedTools (MappedTool[])",
        "In src/types/polaris.ts: Add CompatibleToolVersions interface with fields tool (string), version (string[])",
        "In src/types/polaris.ts: Add ToolVersionMatrix interface with fields type (string), version (string), compatibleTools (CompatibleToolVersions[])",
        "In src/types/polaris.ts: Add ToolVersionSetting interface with fields id (string), toolType (string), version (string), context (string), entityId (string), settingType (string), _type (optional string)",
        "In src/types/polaris.ts: Add CreateToolVersionSettingRequest interface with fields toolType (string), version (string), context (string), entityId (string), settingType (string)",
        "Create src/api/tools.ts: Import getClient from client.ts and all new types from polaris.ts",
        "In src/api/tools.ts: Define media type constants: ACCEPT_TOOL_LIST = 'application/vnd.polaris.tools.tool-list-1+json', ACCEPT_TOOL = 'application/vnd.polaris.tools.tool-1+json', ACCEPT_DOWNLOAD_DESCRIPTOR = 'application/vnd.polaris.tools.download-descriptor-1+json', ACCEPT_VERSION_MAPPING = 'application/vnd.polaris.tools.version-mapping-list-1+json', ACCEPT_VERSION_MATRIX = 'application/vnd.polaris.tools.version-matrix-1+json', ACCEPT_VERSION_SETTINGS = 'application/vnd.polaris.tools.version-settings-1+json', ACCEPT_TOOL_CONFIG_LIST = 'application/vnd.polaris.tools.tool-config-list-1+json', CONTENT_TYPE_VERSION_SETTINGS_REQUEST = 'application/vnd.polaris.tools.version-settings-request-1+json'",
        "Create src/services/tools.ts: Import from src/api/tools.ts with `import * as toolsApi`",
        "In src/services/index.ts: Add `export * from './tools.ts'` to re-export the tools service",
        "Reference specs/tools.yaml for all media type names and schemas",
        "`deno task check` passes with no type errors",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "Foundation story for the entire Tools API. All subsequent stories depend on this. No MCP tools are created here -- only the API layer, service layer scaffolding, type definitions, and media type constants. The CompatibleToolVersions sub-interface is needed because the version-matrix response nests tool+version arrays differently from version-mapping.",
      "claimed_by": "agent-1",
      "claimed_at": "2026-02-19T22:10:40Z"
    },
    {
      "id": "PRD-TL2",
      "title": "Implement tool listing, detail, download descriptor, and license endpoints",
      "description": "Add four read-only endpoints: (1) GET /api/tools to list all available tools with offset pagination and RSQL filter support. (2) GET /api/tools/{id} to get a single tool detail by its name:version ID. (3) GET /api/tools/download-descriptors/{id} to get a signed download URL for a tool binary by its name:version:platform:extension ID. (4) GET /api/tools/{toolName}/license to download the license file for a tool (currently only coverity-analysis is supported).",
      "acceptanceCriteria": [
        "In src/api/tools.ts: Add getTools(params) — GET /api/tools using client.getAllOffset<PolarisTool>() with optional _filter param, accepts ACCEPT_TOOL_LIST",
        "In src/api/tools.ts: Add getTool(id) — GET /api/tools/{id} using client.get<PolarisTool>(), accepts ACCEPT_TOOL",
        "In src/api/tools.ts: Add getDownloadDescriptor(id) — GET /api/tools/download-descriptors/{id} using client.get<DownloadDescriptor>(), accepts ACCEPT_DOWNLOAD_DESCRIPTOR",
        "In src/api/tools.ts: Add getToolLicense(toolName) — GET /api/tools/{toolName}/license using client.get<string>() or appropriate binary fetch, returns license content",
        "In src/services/tools.ts: Add getTools(options?: { filter?: string }) service wrapper",
        "In src/services/tools.ts: Add getTool(options: { id: string }) service wrapper",
        "In src/services/tools.ts: Add getDownloadDescriptor(options: { id: string }) service wrapper",
        "In src/services/tools.ts: Add getToolLicense(options: { toolName: string }) service wrapper",
        "Create src/mcp/tools/get-tools.ts: Tool get_tools with schema filter (optional string for RSQL filter). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/get-tool.ts: Tool get_tool with schema id (required string, described as 'Tool ID in name:version format'). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/get-download-descriptor.ts: Tool get_download_descriptor with schema id (required string, described as 'Download descriptor ID in name:version:platform:extension format'). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/get-tool-license.ts: Tool get_tool_license with schema tool_name (required string, described as 'Tool name, e.g. coverity-analysis'). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Register all four tools in src/mcp/tools/index.ts",
        "Reference specs/tools.yaml: getTools (line 241), getToolById (line 623), getDownloadDescriptorByIdForTools (line 116), downloadToolLicense (line 674)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-TL1. The tool ID format is name:version (e.g. cov_thin_client:2022.3.0). The download descriptor ID format is name:version:platform:extension (e.g. cov_thin_client:2022.3.0:win64:tar.gz). License endpoint returns binary/octet-stream -- handle appropriately in the tool handler (may return text content directly)."
    },
    {
      "id": "PRD-TL3",
      "title": "Implement version mapping and version matrix endpoints",
      "description": "Add two read-only endpoints: (1) GET /api/tools/version-mapping to retrieve tool version mappings showing which tools are mapped to which versions, with offset pagination and RSQL filter. (2) GET /api/tools/{id}/version-matrix to get the version compatibility matrix for a specific tool, showing which versions of other tools are compatible.",
      "acceptanceCriteria": [
        "In src/api/tools.ts: Add getVersionMapping(params) — GET /api/tools/version-mapping using client.getAllOffset<ToolVersionMapping>() with optional _filter param, accepts ACCEPT_VERSION_MAPPING",
        "In src/api/tools.ts: Add getVersionMatrix(id) — GET /api/tools/{id}/version-matrix using client.get<ToolVersionMatrix>(), accepts ACCEPT_VERSION_MATRIX",
        "In src/services/tools.ts: Add getVersionMapping(options?: { filter?: string }) service wrapper",
        "In src/services/tools.ts: Add getVersionMatrix(options: { id: string }) service wrapper",
        "Create src/mcp/tools/get-version-mapping.ts: Tool get_version_mapping with schema filter (optional string for RSQL filter on type, version). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/get-version-matrix.ts: Tool get_version_matrix with schema id (required string, described as 'Tool ID in name:version format'). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Register both tools in src/mcp/tools/index.ts",
        "Reference specs/tools.yaml: getVersionMapping (line 301), getVersionMatrixForToolId (line 353)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-TL1. Version mapping shows which scanner tools map to which analysis engine versions. Version matrix shows compatibility between a specific tool version and other tools. The version-matrix endpoint returns a single object (not paginated) -- use client.get()."
    },
    {
      "id": "PRD-TL4",
      "title": "Implement version settings CRUD endpoints",
      "description": "Add five endpoints for managing tool version settings at different scoping levels (tenant, application, project, branch): (1) POST /api/tools/version-settings to create a new version setting. (2) GET /api/tools/version-settings to list all version settings with RSQL filter. (3) GET /api/tools/version-settings/context/{context} to get settings for a specific context with optional entityId query param. (4) PUT /api/tools/version-settings/{id} to update an existing version setting. (5) DELETE /api/tools/version-settings/{id} to delete a version setting.",
      "acceptanceCriteria": [
        "In src/api/tools.ts: Add createVersionSetting(body) — POST /api/tools/version-settings with CreateToolVersionSettingRequest body, Content-Type CONTENT_TYPE_VERSION_SETTINGS_REQUEST, Accept ACCEPT_VERSION_SETTINGS, returns ToolVersionSetting",
        "In src/api/tools.ts: Add getVersionSettings(params) — GET /api/tools/version-settings using client.getAllOffset<ToolVersionSetting>() with optional _filter param, accepts ACCEPT_TOOL_CONFIG_LIST",
        "In src/api/tools.ts: Add getVersionSettingsByContext(context, entityId?) — GET /api/tools/version-settings/context/{context} with optional entityId query param using client.getAllOffset<ToolVersionSetting>(), accepts ACCEPT_TOOL_CONFIG_LIST",
        "In src/api/tools.ts: Add updateVersionSetting(id, body) — PUT /api/tools/version-settings/{id} with CreateToolVersionSettingRequest body, Content-Type CONTENT_TYPE_VERSION_SETTINGS_REQUEST, Accept ACCEPT_VERSION_SETTINGS, returns ToolVersionSetting",
        "In src/api/tools.ts: Add deleteVersionSetting(id) — DELETE /api/tools/version-settings/{id}, returns void",
        "In src/services/tools.ts: Add createVersionSetting(options: CreateVersionSettingOptions) service with fields: toolType, version, context, entityId, settingType",
        "In src/services/tools.ts: Add getVersionSettings(options?: { filter?: string }) service wrapper",
        "In src/services/tools.ts: Add getVersionSettingsByContext(options: { context: string, entityId?: string }) service wrapper",
        "In src/services/tools.ts: Add updateVersionSetting(options: UpdateVersionSettingOptions) service with fields: id, toolType, version, context, entityId, settingType",
        "In src/services/tools.ts: Add deleteVersionSetting(options: { id: string }) service wrapper",
        "Create src/mcp/tools/create-version-setting.ts: Tool create_version_setting with schema tool_type (required string), version (required string), context (required string), entity_id (required string), setting_type (required string). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Create src/mcp/tools/get-version-settings.ts: Tool get_version_settings with schema filter (optional string). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/get-version-settings-by-context.ts: Tool get_version_settings_by_context with schema context (required string), entity_id (optional string). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/update-version-setting.ts: Tool update_version_setting with schema id (required string), tool_type (required string), version (required string), context (required string), entity_id (required string), setting_type (required string). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Create src/mcp/tools/delete-version-setting.ts: Tool delete_version_setting with schema id (required string). Annotations: { readOnlyHint: false, destructiveHint: true, openWorldHint: true }",
        "Register all five tools in src/mcp/tools/index.ts",
        "Reference specs/tools.yaml: createVersionSettings (line 382), getVersionSettings (line 421), getVersionSettingsForContext (line 471), updateVersionSettings (line 523), deleteVersionSettings (line 564)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-TL1. Version settings allow pinning tool versions at different scoping levels: tenant (org-wide), application, project, or branch. The update endpoint uses PUT (full replacement), not PATCH. Context values include 'tenant', 'application', 'project', 'branch'. The create and update endpoints use a different Content-Type (version-settings-request-1) than the Accept header (version-settings-1)."
    }
  ]
}
