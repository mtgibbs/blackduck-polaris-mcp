{
  "project": "blackduck-polaris-mcp",
  "branchName": "ralph/bug-tracking-api",
  "description": "Complete the Bug Tracking Integration API for the Black Duck Polaris MCP server. Existing code covers configurations list/detail, external projects list, external issue types, project mappings list, and issue export. This branch adds missing types, exposes already-implemented API functions as MCP tools, implements config CRUD + test connection, project mappings CRUD under a config, external project by key lookup, and issue export delete + comment endpoints. All endpoints use base path /api/integrations/bugtracking and media type application/vnd.polaris.bugtracking.configuration-1+json. OAuth endpoints are excluded.",
  "userStories": [
    {
      "id": "PRD-BT1",
      "title": "Add missing types and expose tools for already-implemented API functions",
      "description": "Several API functions already exist in src/api/bug-tracking.ts (getExternalIssueTypes, getLinkedIssues, getLinkedIssue) and service wrappers exist for getExternalIssueTypes, but MCP tool files are missing. Additionally, request/response types needed for later stories (CreateBugTrackingConfigRequest, UpdateBugTrackingConfigRequest, TestConnectionResult, CreateProjectMappingRequest, UpdateProjectMappingRequest, ExportCommentRequest) must be added to src/types/polaris.ts. This story creates the foundation types and wires up the three missing tools.",
      "acceptanceCriteria": [
        "In src/types/polaris.ts: Add CreateBugTrackingConfigRequest interface with fields url (string), type (BugTrackingSystemType), enabled (boolean), details (object with optional deploymentType for JIRA, optional accessToken for AZURE)",
        "In src/types/polaris.ts: Add UpdateBugTrackingConfigRequest interface with same shape as CreateBugTrackingConfigRequest (all fields optional for PATCH semantics)",
        "In src/types/polaris.ts: Add TestConnectionResult interface with fields status (string), message (optional string)",
        "In src/types/polaris.ts: Add CreateProjectMappingRequest interface with fields projectId (string), btsProjectKey (string), btsProjectId (optional string), btsIssueType (string)",
        "In src/types/polaris.ts: Add UpdateProjectMappingRequest interface with fields btsProjectKey (optional string), btsProjectId (optional string), btsIssueType (optional string)",
        "In src/types/polaris.ts: Add ExportCommentRequest interface with field comment (string)",
        "Create src/mcp/tools/get-external-issue-types.ts: Tool get_external_issue_types with schema config_id (required string), project_key (required string). Annotations: { readOnlyHint: true, openWorldHint: true }. Handler calls getExternalIssueTypes from services",
        "In src/services/bug-tracking.ts: Add getLinkedIssues(options: GetLinkedIssuesOptions) service wrapper that calls bugTrackingApi.getLinkedIssues(options.configurationId)",
        "In src/services/bug-tracking.ts: Add getLinkedIssue(options: GetLinkedIssueOptions) service wrapper that calls bugTrackingApi.getLinkedIssue(options.configurationId, options.issueId)",
        "Create src/mcp/tools/get-linked-issues.ts: Tool get_linked_issues with schema config_id (required string). Annotations: { readOnlyHint: true, openWorldHint: true }. Handler calls getLinkedIssues service",
        "Create src/mcp/tools/get-linked-issue.ts: Tool get_linked_issue with schema config_id (required string), issue_id (required string). Annotations: { readOnlyHint: true, openWorldHint: true }. Handler calls getLinkedIssue service",
        "Register all three new tools in src/mcp/tools/index.ts",
        "Reference specs/bug-tracking-integration.yaml for endpoint schemas: getBugTrackingIssueTypes (line 4760), getBtsLinkedIssues (line 4969), getBtsLinkedIssue (line 5053)",
        "`deno task check` passes with no type errors",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": "Foundation story. Must complete before PRD-BT2 through PRD-BT5. The getExternalIssueTypes service function already exists but has no tool file. The getLinkedIssues and getLinkedIssue API functions exist but need service wrappers and tool files. All new types are needed by subsequent stories."
    },
    {
      "id": "PRD-BT2",
      "title": "Implement config CRUD and test connection endpoints",
      "description": "Add four endpoints for bug tracking configuration management: (1) POST /configurations to create a new bug tracking config (Jira or Azure), requiring a 'system' query parameter. (2) PATCH /configurations/{id} to update an existing config. (3) DELETE /configurations/{id} to delete a config and its related OAuth, access token, and project mapping resources. (4) POST /configurations/{id}/connection to test the connection to the bug tracking instance. All use Accept/Content-Type: application/vnd.polaris.bugtracking.configuration-1+json.",
      "acceptanceCriteria": [
        "In src/api/bug-tracking.ts: Add createConfiguration() function \u2014 POST /api/integrations/bugtracking/configurations with system query param, body as CreateBugTrackingConfigRequest, uses client.fetch(), returns BugTrackingConfiguration",
        "In src/api/bug-tracking.ts: Add updateConfiguration() function \u2014 PATCH /api/integrations/bugtracking/configurations/{id} with body as UpdateBugTrackingConfigRequest, uses client.fetch(), returns BugTrackingConfiguration",
        "In src/api/bug-tracking.ts: Add deleteConfiguration() function \u2014 DELETE /api/integrations/bugtracking/configurations/{id}, uses client.fetch() with method DELETE, returns void",
        "In src/api/bug-tracking.ts: Add testConnection() function \u2014 POST /api/integrations/bugtracking/configurations/{id}/connection, uses client.fetch(), returns TestConnectionResult",
        "In src/services/bug-tracking.ts: Add createBugTrackingConfiguration(options) service wrapper using options object pattern with fields: system (string), url (string), type (BugTrackingSystemType), enabled (boolean), details (object)",
        "In src/services/bug-tracking.ts: Add updateBugTrackingConfiguration(options) service wrapper with fields: id (string), plus optional update fields",
        "In src/services/bug-tracking.ts: Add deleteBugTrackingConfiguration(options) service wrapper with field: id (string)",
        "In src/services/bug-tracking.ts: Add testBugTrackingConnection(options) service wrapper with field: id (string)",
        "Create src/mcp/tools/create-bug-tracking-config.ts: Tool create_bug_tracking_config with schema system (required string enum 'jira'|'azure'), url (required string), type (required string enum 'JIRA'|'AZURE'), enabled (required boolean), deployment_type (optional string), access_token (optional string). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Create src/mcp/tools/update-bug-tracking-config.ts: Tool update_bug_tracking_config with schema id (required string), url (optional string), type (optional string), enabled (optional boolean), deployment_type (optional string), access_token (optional string). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Create src/mcp/tools/delete-bug-tracking-config.ts: Tool delete_bug_tracking_config with schema id (required string). Annotations: { readOnlyHint: false, destructiveHint: true, openWorldHint: true }",
        "Create src/mcp/tools/test-bug-tracking-connection.ts: Tool test_bug_tracking_connection with schema id (required string). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Register all four tools in src/mcp/tools/index.ts",
        "Reference specs/bug-tracking-integration.yaml: createBugTrackingConfig (line 2925), updateBugTrackingConfig (line 3158), deleteBugTrackingConfigurationById (line 3382), testBugTrackingConnection (line 3466)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-BT1 for CreateBugTrackingConfigRequest, UpdateBugTrackingConfigRequest, and TestConnectionResult types. POST /configurations requires a 'system' query parameter (jira or azure). DELETE cascades to OAuth, access tokens, and project mappings. Test connection (POST /connection) is read-only from the user's perspective but uses POST."
    },
    {
      "id": "PRD-BT3",
      "title": "Implement project mappings CRUD under a configuration",
      "description": "Add five endpoints for managing project mappings between Polaris projects and BTS projects under a specific bug tracking configuration: (1) POST /configurations/{id}/project-mappings to create a mapping. (2) GET /configurations/{id}/project-mappings to list all mappings for a config. (3) GET /configurations/{id}/project-mappings/{projectMappingId} to get a single mapping. (4) PATCH /configurations/{id}/project-mappings/{projectMappingId} to update a mapping. (5) DELETE /configurations/{id}/project-mappings/{projectMappingId} to delete a mapping (cascades to linked issues under it).",
      "acceptanceCriteria": [
        "In src/api/bug-tracking.ts: Add createConfigProjectMapping() \u2014 POST /api/integrations/bugtracking/configurations/{id}/project-mappings with CreateProjectMappingRequest body, returns ProjectMapping",
        "In src/api/bug-tracking.ts: Add getConfigProjectMappings() \u2014 GET /api/integrations/bugtracking/configurations/{id}/project-mappings using client.getAllOffset(), returns ProjectMapping[]",
        "In src/api/bug-tracking.ts: Add getConfigProjectMapping() \u2014 GET /api/integrations/bugtracking/configurations/{id}/project-mappings/{projectMappingId} using client.get(), returns ProjectMapping",
        "In src/api/bug-tracking.ts: Add updateConfigProjectMapping() \u2014 PATCH /api/integrations/bugtracking/configurations/{id}/project-mappings/{projectMappingId} with UpdateProjectMappingRequest body, returns ProjectMapping",
        "In src/api/bug-tracking.ts: Add deleteConfigProjectMapping() \u2014 DELETE /api/integrations/bugtracking/configurations/{id}/project-mappings/{projectMappingId}, returns void",
        "In src/services/bug-tracking.ts: Add createConfigProjectMapping(options) service with fields: configurationId, projectId, btsProjectKey, btsProjectId?, btsIssueType",
        "In src/services/bug-tracking.ts: Add getConfigProjectMappings(options) service with field: configurationId",
        "In src/services/bug-tracking.ts: Add getConfigProjectMapping(options) service with fields: configurationId, projectMappingId",
        "In src/services/bug-tracking.ts: Add updateConfigProjectMapping(options) service with fields: configurationId, projectMappingId, btsProjectKey?, btsProjectId?, btsIssueType?",
        "In src/services/bug-tracking.ts: Add deleteConfigProjectMapping(options) service with fields: configurationId, projectMappingId",
        "Create src/mcp/tools/create-project-mapping.ts: Tool create_project_mapping with schema config_id (required), project_id (required), bts_project_key (required), bts_project_id (optional), bts_issue_type (required). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Create src/mcp/tools/get-config-project-mappings.ts: Tool get_config_project_mappings with schema config_id (required). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/get-config-project-mapping.ts: Tool get_config_project_mapping with schema config_id (required), project_mapping_id (required). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Create src/mcp/tools/update-project-mapping.ts: Tool update_project_mapping with schema config_id (required), project_mapping_id (required), bts_project_key (optional), bts_project_id (optional), bts_issue_type (optional). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Create src/mcp/tools/delete-project-mapping.ts: Tool delete_project_mapping with schema config_id (required), project_mapping_id (required). Annotations: { readOnlyHint: false, destructiveHint: true, openWorldHint: true }",
        "Register all five tools in src/mcp/tools/index.ts",
        "Reference specs/bug-tracking-integration.yaml: createBtsProjectMapping (line 5451), getBtsProjectMappings (line 5546), getBtsProjectMapping (line 5851), updateBtsProjectMapping (line 5734), deleteBtsProjectMapping (line 5631)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-BT1 for CreateProjectMappingRequest and UpdateProjectMappingRequest types. These config-scoped project mappings are distinct from the tenant-level /project-mappings endpoint that already exists. DELETE cascades to linked issues under the mapping."
    },
    {
      "id": "PRD-BT4",
      "title": "Implement external project by key lookup",
      "description": "Add one endpoint: GET /configurations/{id}/projects/{projectKey} to retrieve a single external project from the bug tracking system using a case-sensitive project key. This complements the existing getExternalProjects (list) endpoint.",
      "acceptanceCriteria": [
        "In src/api/bug-tracking.ts: Add getExternalProjectByKey() function \u2014 GET /api/integrations/bugtracking/configurations/{id}/projects/{projectKey} using client.get(), returns ExternalProject",
        "In src/services/bug-tracking.ts: Add getExternalProjectByKey(options) service wrapper with fields: configurationId (string), projectKey (string)",
        "Create src/mcp/tools/get-external-project-by-key.ts: Tool get_external_project_by_key with schema config_id (required string, described as 'Bug tracking configuration ID'), project_key (required string, described as 'Case-sensitive project key in the external bug tracking system'). Annotations: { readOnlyHint: true, openWorldHint: true }",
        "Register tool in src/mcp/tools/index.ts",
        "Reference specs/bug-tracking-integration.yaml: getBugTrackingProjectByKey (line 4656)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Depends on PRD-BT1. Simple single-endpoint story. The projectKey path parameter is case-sensitive. Reuses the existing ExternalProject type."
    },
    {
      "id": "PRD-BT5",
      "title": "Implement delete issue export and add comment endpoints",
      "description": "Add two endpoints for managing exported/linked issues: (1) DELETE /configurations/{id}/issues-export/{issueId} to remove the association between a Polaris issue and its BTS ticket (does not delete the actual BTS ticket). (2) POST /configurations/{id}/issues-export/{issueId}/comments to add a comment to a linked issue in the external bug tracking system.",
      "acceptanceCriteria": [
        "In src/api/bug-tracking.ts: Add deleteIssueExport() function \u2014 DELETE /api/integrations/bugtracking/configurations/{id}/issues-export/{issueId} using client.fetch() with method DELETE, returns void",
        "In src/api/bug-tracking.ts: Add addIssueExportComment() function \u2014 POST /api/integrations/bugtracking/configurations/{id}/issues-export/{issueId}/comments with ExportCommentRequest body using client.fetch(), returns response object",
        "In src/services/bug-tracking.ts: Add deleteIssueExport(options) service wrapper with fields: configurationId (string), issueId (string)",
        "In src/services/bug-tracking.ts: Add addIssueExportComment(options) service wrapper with fields: configurationId (string), issueId (string), comment (string)",
        "Create src/mcp/tools/delete-issue-export.ts: Tool delete_issue_export with schema config_id (required string), issue_id (required string). Annotations: { readOnlyHint: false, destructiveHint: true, openWorldHint: true }",
        "Create src/mcp/tools/add-issue-export-comment.ts: Tool add_issue_export_comment with schema config_id (required string), issue_id (required string), comment (required string). Annotations: { readOnlyHint: false, openWorldHint: true }",
        "Register both tools in src/mcp/tools/index.ts",
        "Reference specs/bug-tracking-integration.yaml: deleteBtsLinkedIssue (line 5139), createCommentForBtsLinkedIssue (line 5239)",
        "`deno task check` passes",
        "`deno task lint` passes",
        "`deno fmt --check` passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Depends on PRD-BT1 for ExportCommentRequest type. Delete only removes the Polaris-side link record, not the actual BTS issue. The comment endpoint creates a comment on the BTS ticket via the integration."
    }
  ]
}