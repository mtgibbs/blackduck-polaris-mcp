## Codebase Patterns
- Tool definition pattern: plain object of Zod types (NOT wrapped in z.object()), exported as `schema`
- Service wrappers use an `Options` interface with camelCase fields, destructure and call the API layer
- API layer functions use positional parameters (e.g., `getExternalProjectByKey(configurationId, projectKey)`)
- All bug tracking endpoints use `ACCEPT = "application/vnd.polaris.bugtracking.configuration-1+json"`
- `client.get<T>(path, params, accept)` for single resource GET endpoints
- `client.getAllOffset<T>(path, params, accept)` for list GET endpoints
- Tools import from `../../services/index.ts` (re-exports all services)
- All tools re-exported from `src/mcp/tools/index.ts` flat array
- Format: 100 char width, 2 spaces, double quotes (`deno fmt --check` to validate)

---

## 2026-02-19 - PRD-BT4
- Implemented external project by key lookup (GET /configurations/{id}/projects/{projectKey})
- Files changed:
  - src/api/bug-tracking.ts: Added `getExternalProjectByKey(configurationId, projectKey)` function using `client.get()`
  - src/services/bug-tracking.ts: Added `GetExternalProjectByKeyOptions` interface and `getExternalProjectByKey(options)` service wrapper
  - src/mcp/tools/get-external-project-by-key.ts: Created new tool `get_external_project_by_key` with `config_id` and `project_key` params
  - src/mcp/tools/index.ts: Registered `getExternalProjectByKeyTool`
- **Learnings for future iterations:**
  - PRD-BT4 is a simple single-endpoint story with no dependencies on other stories' new types (uses existing `ExternalProject` type)
  - The service layer for bug-tracking.ts already had some inconsistency: `getLinkedIssues` and `getLinkedIssue` in services used positional params (not the options pattern), but for new functions we follow the options pattern
  - Quality checks run cleanly: `deno task check`, `deno task lint`, `deno fmt --check` all pass
---

## 2026-02-19 - PRD-BT5
- Implemented delete issue export and add comment endpoints
- Files changed:
  - src/api/bug-tracking.ts: Added `deleteIssueExport(configurationId, issueId)` and `addIssueExportComment(configurationId, issueId, body)` functions
  - src/services/bug-tracking.ts: Added `DeleteIssueExportOptions`, `deleteIssueExport(options)`, `AddIssueExportCommentOptions`, `addIssueExportComment(options)` service wrappers
  - src/mcp/tools/delete-issue-export.ts: Created tool `delete_issue_export` with `config_id`, `issue_id` params, annotations include `destructiveHint: true`
  - src/mcp/tools/add-issue-export-comment.ts: Created tool `add_issue_export_comment` with `config_id`, `issue_id`, `comment` params
  - src/mcp/tools/index.ts: Registered both new tools
  - prd.json: Set passes=true for PRD-BT5
- **Learnings for future iterations:**
  - `ExportCommentRequest` type was already added by PRD-BT1/agent-1 work before this iteration
  - DELETE endpoints with no return body: use `client.fetch<void>()` with `method: "DELETE"`, `accept: ACCEPT` only (no contentType needed)
  - For void-return DELETE tools, return `jsonResponse({ success: true })` as confirmation
  - All checks passed: `deno task check`, `deno task lint`, `deno fmt --check`
---
