## 2026-02-19T23:30:00Z - PRD-R7
- Implemented Test settings management (create, get, delete)
- Files changed:
  - `src/api/repos.ts`: Added `TestSettingsResponse` type import; added `createTestSettings()`, `getTestSettings()`, `deleteTestSettings()` API functions with interfaces (CreateTestSettingsParams, GetTestSettingsParams, DeleteTestSettingsParams)
  - `src/services/repos.ts`: Added `TestSettingsResponse` type import; added `createScmTestSettings()`, `getScmTestSettings()`, `deleteScmTestSettings()` service functions with Options interfaces; `createScmTestSettings` constructs nested testSyncSettings from flat options
  - `src/mcp/tools/create-scm-test-settings.ts` (new): Write tool for creating test settings; splits comma-separated assessment types into arrays
  - `src/mcp/tools/get-scm-test-settings.ts` (new): Read tool for getting test settings by scopeId and scope
  - `src/mcp/tools/delete-scm-test-settings.ts` (new): Write+destructive tool for deleting test settings (includes destructiveHint: true)
  - `src/mcp/tools/index.ts`: Registered all 3 new tools
  - `prd.json`: Set PRD-R7 passes: true
- All checks pass: `deno task check`, `deno lint`, `deno fmt --check`
- **Learnings for future iterations:**
  - `deleteTestSettings` uses `client.fetch()` with method DELETE and passes scope as query param via `params` option
  - `createTestSettings` POST uses only contentType (no accept) per spec; returns void (202)
  - The delete tool requires `destructiveHint: true` in annotations
  - Nested testSyncSettings structure is built in the service layer from flat options for cleaner MCP tool interface
---

## 2026-02-19T23:15:00Z - PRD-R6
- Implemented Groups settings, connection testing, and mapping status
- Files changed:
  - `src/api/repos.ts`: Added type imports for GroupMappingStatus, GroupsSettings; added `updateGroupSettings()`, `getGroupSettings()`, `testGroupConnection()`, `getGroupMappingStatus()` API functions with interfaces (RepositorySubSettings, BranchSubSettings, UpdateGroupSettingsParams, GetGroupSettingsParams, TestGroupConnectionParams, GetGroupMappingStatusParams)
  - `src/services/repos.ts`: Added type imports for GroupMappingStatus, GroupsSettings; added `updateScmGroupSettings()`, `getScmGroupSettings()`, `testScmGroupConnection()`, `getScmGroupMappingStatus()` service functions with Options interfaces
  - `src/mcp/tools/update-scm-group-settings.ts` (new): Write tool for updating group sync settings; splits branch_name_expressions by comma
  - `src/mcp/tools/get-scm-group-settings.ts` (new): Read tool for listing group settings with optional filter
  - `src/mcp/tools/test-scm-group-connection.ts` (new): Write tool for testing group connection with X-Polaris-SCM-PAT header
  - `src/mcp/tools/get-scm-group-mapping-status.ts` (new): Read tool for getting group mapping status by applicationId
  - `src/mcp/tools/index.ts`: Registered all 4 new tools
  - `prd.json`: Set PRD-R6 passes: true
- All checks pass: `deno task check`, `deno lint`, `deno fmt --check`
- **Learnings for future iterations:**
  - `updateGroupSettings` PATCH uses only contentType (no accept) per spec; returns void (202)
  - `testGroupConnection` POST uses only contentType (no accept) and requires X-Polaris-SCM-PAT custom header in client.fetch() headers option
  - `getGroupMappingStatus` uses ACCEPT_GROUP_MAPPING_STATUS which lacks ;charset=UTF-8 suffix
  - When tools return void (no body), handler returns `jsonResponse({ success: true })` as confirmation
---

## 2026-02-19T23:00:00Z - PRD-R5
- Implemented Bulk group import and job management
- Files changed:
  - `src/api/repos.ts`: Added imports for BulkGroupImportJobStatus, BulkGroupImportUpdateResponse; added `importGroupsRepos()`, `updateGroupImportJob()`, `getGroupImportJobStatus()`, `getAllGroupImportStatuses()` API functions with interfaces (RoleUserMapping, GroupRepositorySelection, ImportGroupsReposParams, UpdateGroupImportJobParams, GetAllGroupImportStatusesParams)
  - `src/services/repos.ts`: Added imports for BulkGroupImportJobStatus, BulkGroupImportUpdateResponse; added `bulkImportGroups()`, `abortGroupImportJob()`, `getGroupImportJobStatus()`, `getAllGroupImportStatuses()` service functions with Options interfaces
  - `src/mcp/tools/bulk-import-groups.ts` (new): Write tool for initiating bulk group+repo import; parses repository_selections JSON string and splits comma-separated policy IDs
  - `src/mcp/tools/abort-group-import-job.ts` (new): Write tool for aborting a bulk group import job
  - `src/mcp/tools/get-group-import-job-status.ts` (new): Read tool for getting a single job status by ID
  - `src/mcp/tools/get-all-group-import-statuses.ts` (new): Read tool for listing all group import job statuses with optional filter
  - `src/mcp/tools/index.ts`: Registered all 4 new tools
  - `prd.json`: Set PRD-R5 passes: true
- All checks pass: `deno task check`, `deno lint`, `deno fmt --check`
- **Learnings for future iterations:**
  - The `abortGroupImportJob` service hardcodes `action: "ABORT"` per spec (only valid action)
  - Bulk group import POST uses `fetchLocation()` same as bulk repo import for 202+Location pattern
  - `GroupRepositorySelection` interface reuses `RepositorySelection` for repositories/nestedRepositories fields
---

## Codebase Patterns

- `import { getClient }` in API files must be aliased as `_getClient` if not used in that file, or deno lint will fail with no-unused-vars
- `deno lint` and `deno fmt --check` work without network; `deno task lint` downloads npm packages on first run
- Services scaffold: use `import * as _reposApi from "../api/repos.ts"` with underscore prefix when no functions are exported yet
- ScmRepositoryWithBranch: spec wraps response in a `body` property but the TypeScript interface captures the fields directly
- Two Accept media type constants lack `;charset=UTF-8` suffix: ACCEPT_GROUP_MAPPING_STATUS and ACCEPT_TEST_SETTINGS
- Custom headers (e.g. X-Polaris-SCM-PAT): extend `RequestOptions.headers?: Record<string, string>` in client.ts; fetch() loops over it to set on the Headers object
- No-arg MCP tools: use `_placeholder: z.string().optional()` in schema and `handler: async () => {}`
- SCM endpoints with cursor pagination: accept cursor/limit params and return a single page via client.fetch() (not getAllOffset/getAllCursor) since custom headers can't be passed through pagination helpers

- For 202+Location header responses: add `fetchLocation()` method to PolarisClient in client.ts that returns the Location header string instead of parsing JSON body
- Bulk import tools: MCP tool takes repositories as JSON string (parse with JSON.parse), policy IDs as comma-separated string (split by comma)

---

## 2026-02-19T21:45:00Z - PRD-R1
- Implemented Foundation: API client, service layer, and types for Repos Integration
- Files changed:
  - `src/api/repos.ts` (new): Media type constants for all 23 Repos Integration Accept/Content-Type headers
  - `src/services/repos.ts` (new): Minimal scaffold with import ready for functions in subsequent stories
  - `src/services/index.ts`: Added `export * from "./repos.ts";` after bug-tracking export
  - `src/types/polaris.ts`: Added `// --- Repos Integration ---` section with 18 TypeScript interfaces/types
  - `prd.json`: Set PRD-R1 passes: true
- `deno task lint` passes, `deno fmt --check` passes
- **Learnings for future iterations:**
  - The `_getClient` alias (underscore prefix) satisfies deno's no-unused-vars lint rule for the required getClient import
  - The ScmRepositoryWithBranch type has `defaultBranchName` as optional field (not a separate `body` wrapper)
  - ACCEPT_GROUP_MAPPING_STATUS and ACCEPT_TEST_SETTINGS intentionally lack `;charset=UTF-8` per spec
  - All 23 media type constants are exported from src/api/repos.ts for use by subsequent stories
  - GroupsSettings.settings has nested repository and branch sub-objects per spec 3339-3376
---

## 2026-02-19T22:00:00Z - PRD-R2
- Implemented Core repository CRUD and connection testing
- Files changed:
  - `src/api/repos.ts`: Added 6 API functions (getRepositories, createRepository, getRepository, updateRepository, testRepoConnection, getRepositoryBranches) with param interfaces; changed import from `_getClient` alias to `getClient` since it's now used
  - `src/services/repos.ts`: Added 6 service functions with Options interfaces (getScmRepositories, createScmRepository, getScmRepository, updateScmRepository, testScmRepoConnection, getScmRepositoryBranches)
  - `src/mcp/tools/get-scm-repositories.ts` (new): Read tool for listing repos with optional filter
  - `src/mcp/tools/get-scm-repository.ts` (new): Read tool for single repo by ID with optional include
  - `src/mcp/tools/get-scm-repository-branches.ts` (new): Read tool for listing repo branches
  - `src/mcp/tools/create-scm-repository.ts` (new): Write tool for creating a repo
  - `src/mcp/tools/update-scm-repository.ts` (new): Write tool for updating a repo (PATCH)
  - `src/mcp/tools/test-scm-repo-connection.ts` (new): Write tool for testing connection
  - `src/mcp/tools/index.ts`: Registered all 6 new tools
  - `prd.json`: Set PRD-R2 passes: true
- All checks pass: `deno task check`, `deno task lint`, `deno fmt --check`
- **Learnings for future iterations:**
  - When `getClient` is actually used in functions, remove the `_getClient` alias and use `getClient` directly
  - `deno fmt` auto-fixes line length issues; always run after writing long lines
  - Service layer for auth params: construct `scmAuthentication` object conditionally only if any auth fields provided
  - ScmAuthentication is a reusable interface defined in api/repos.ts that other stories can import
---

## 2026-02-19T22:35:00Z - PRD-R4
- Implemented Bulk repository import and status tracking
- Files changed:
  - `src/api/client.ts`: Added `fetchLocation()` method to PolarisClient for 202+Location header responses
  - `src/api/repos.ts`: Added imports for BulkRepoImportGroupStatus; added `importReposForGroup()` and `getRepoImportGroupsStatus()` API functions with interfaces (RepositorySelection, PolicySettings, ImportReposForGroupParams, GetRepoImportGroupsStatusParams)
  - `src/services/repos.ts`: Added import for BulkRepoImportGroupStatus; added `bulkImportRepos()` and `getBulkRepoImportGroupsStatus()` service functions with Options interfaces
  - `src/mcp/tools/bulk-import-repos.ts` (new): Write tool for initiating bulk repo import; parses repositories JSON string and splits comma-separated policy IDs
  - `src/mcp/tools/get-bulk-repo-import-groups-status.ts` (new): Read tool for getting bulk import groups status with optional filter
  - `src/mcp/tools/index.ts`: Registered both new tools
  - `prd.json`: Set PRD-R4 passes: true
- All checks pass: `deno task check`, `deno lint`, `deno fmt --check`
- **Learnings for future iterations:**
  - HTTP 202 responses with Location header require a new client method `fetchLocation()` since `fetch()` tries to parse JSON body
  - `client.fetchLocation()` returns `Promise<string>` (the Location header value)
  - The pattern `Promise<{ location: string }>` wraps the location string for consistent API shape

---

## 2026-02-19T22:20:00Z - PRD-R3
- Implemented SCM providers, groups, repositories, projects, and group auth endpoints
- Files changed:
  - `src/api/client.ts`: Added `headers?: Record<string, string>` to RequestOptions interface; fetch() now iterates and sets custom headers
  - `src/api/repos.ts`: Added 6 API functions (getProviders, testScmConnection, getScmGroups, getScmRemoteRepos, getScmProjects, createGroupAuth) with param interfaces; added type imports for ScmGroup, ScmProject, ScmProviderInfo, ScmRemoteRepository
  - `src/services/repos.ts`: Added 6 service functions with Options interfaces (getScmProviders, testScmProviderConnection, getScmProviderGroups, getScmProviderRepositories, getScmProviderProjects, createScmGroupAuth); added type imports
  - `src/mcp/tools/get-scm-providers.ts` (new): Read tool, no-arg pattern with _placeholder
  - `src/mcp/tools/get-scm-groups.ts` (new): Read tool with scm_provider, scm_pat, scm_email, top_level_only
  - `src/mcp/tools/get-scm-remote-repos.ts` (new): Read tool with scm_pat plus optional filters
  - `src/mcp/tools/get-scm-projects.ts` (new): Read tool for Azure DevOps projects within a group
  - `src/mcp/tools/test-scm-provider-connection.ts` (new): Write tool for testing SCM connection
  - `src/mcp/tools/create-scm-group-auth.ts` (new): Write tool for creating group authentication
  - `src/mcp/tools/index.ts`: Registered all 6 new tools
  - `prd.json`: Set PRD-R3 passes: true
- All checks pass: `deno task check`, `deno lint`, `deno fmt --check`
- **Learnings for future iterations:**
  - SCM endpoints with custom headers (X-Polaris-SCM-PAT etc.) must use client.fetch() directly, not getAllOffset/getAllCursor helpers
  - For cursor-paginated SCM endpoints, accept cursor/limit params and return a single page (first page if no cursor given)
  - No-arg tools: use `_placeholder: z.string().optional()` schema + `handler: async () => {}`
---
