## 2026-02-19 - PRD-F7
- Implemented taxonomy endpoints across all layers:
  1. src/types/polaris.ts: Added TaxonLocalizedOtherDetail, TaxonLocalized, Taxon, Taxonomy, TaxonIssueTypeLocalized, TaxonIssueType interfaces
  2. src/api/findings.ts: Added ACCEPT_TAXONOMIES and ACCEPT_TAXA constants; added getTaxonomies() (cursor-paginated), getTaxon() (single GET), getTaxonSubtaxa() (cursor-paginated), getTaxonIssueTypes() (cursor-paginated)
  3. src/services/findings.ts: Added getTaxonomies(), getTaxon(), getTaxonSubtaxa(), getTaxonIssueTypes() service functions
  4. src/mcp/tools/get-taxonomies.ts: Created get_taxonomies tool with include_descendants, include_only_standards, max_results
  5. src/mcp/tools/get-taxon.ts: Created get_taxon tool with required taxon_id
  6. src/mcp/tools/get-taxon-subtaxa.ts: Created get_taxon_subtaxa tool with taxon_id and max_results
  7. src/mcp/tools/get-taxon-issue-types.ts: Created get_taxon_issue_types tool with taxon_id and max_results
  8. src/mcp/tools/index.ts: Registered all four new tools
- Files changed: src/types/polaris.ts, src/api/findings.ts, src/services/findings.ts, src/mcp/tools/get-taxonomies.ts (new), src/mcp/tools/get-taxon.ts (new), src/mcp/tools/get-taxon-subtaxa.ts (new), src/mcp/tools/get-taxon-issue-types.ts (new), src/mcp/tools/index.ts, prd.json
- **Learnings for future iterations:**
  - Taxonomy types: TaxonLocalized has optional `name` and `issueTypeNames` but required `otherDetails`; TaxonIssueType _localized also has optional name
  - ACCEPT_TAXONOMIES = "application/vnd.polaris.findings.taxonomies-1+json", ACCEPT_TAXA = "application/vnd.polaris.findings.taxa-1+json"
  - getTaxon is a single-item GET (not paginated); getTaxonomies/getTaxonSubtaxa/getTaxonIssueTypes use cursor pagination
---

## Codebase Patterns
- Tool definitions: schema is plain object of Zod types (NOT z.object()), handler destructures args, return jsonResponse(data) or errorResponse(msg)
- API layer uses client.fetch<T>() for non-GET requests with {method, params, body, accept, contentType}
- Format check includes YAML files in specs/ — run `deno fmt` on that directory if needed
- `deno task lint` lints only .ts files (33 files); `deno fmt --check` checks all 50 files including YAMLs
- PolarisClient queryParams must be Record<string, string | number | boolean | undefined> — no string[] allowed; join arrays with .join(",") before passing
- getAllCursor<T>() for cursor-paginated GET endpoints; client.fetch<T>() for POST/PATCH/DELETE; client.get<T>() for single-item GETs

---

## 2026-02-19 - PRD-F6
- Fixed provideAssistFeedback across 3 layers:
  1. src/api/findings.ts: return type Promise<void> → Promise<AssistResponse>, Content-Type changed from ACCEPT_OCCURRENCES to 'application/json-patch+json', removed async/await (now directly returns client.fetch promise)
  2. src/services/findings.ts: return type Promise<void> → Promise<AssistResponse>
  3. src/mcp/tools/provide-assist-feedback.ts: handler now captures result and returns jsonResponse(result) instead of jsonResponse({success: true})
- Also formatted pre-existing YAML spec files (specs/*.yaml) that were failing deno fmt --check
- Files changed: src/api/findings.ts, src/services/findings.ts, src/mcp/tools/provide-assist-feedback.ts, specs/*.yaml
- **Learnings for future iterations:**
  - The `deno fmt --check` covers YAML files in specs/ too — 6 YAML files had single-quote vs double-quote issues; run `deno fmt specs/` to fix
  - client.fetch<T>() is the low-level method for non-GET; GET uses client.get<T>()
  - prd.json already has passes: false; update it to passes: true (don't duplicate the field)
---

## 2026-02-19 - PRD-F3
- Implemented issue triage action and issue count endpoints across all layers:
  1. src/types/polaris.ts: Added TriageKey, TriagePropertyInput, TriageRequest, TriageResult, IssueCountGroup, IssueCountItem interfaces
  2. src/api/findings.ts: Added triageIssues() (POST to _actions/triage) and getIssueCount() (cursor-paginated GET to _actions/count)
  3. src/services/findings.ts: Added triageIssues() and getIssueCount() service functions
  4. src/mcp/tools/triage-issues.ts: Created triage_issues tool (readOnlyHint: false) with Zod schema including scoping params, filter, and triage_properties array
  5. src/mcp/tools/get-issue-count.ts: Created get_issue_count tool (readOnlyHint: true) with group, include_average_age, filter params
  6. src/mcp/tools/index.ts: Registered both new tools
- Files changed: src/types/polaris.ts, src/api/findings.ts, src/services/findings.ts, src/mcp/tools/triage-issues.ts (new), src/mcp/tools/get-issue-count.ts (new), src/mcp/tools/index.ts, prd.json
- **Learnings for future iterations:**
  - PolarisClient.buildUrl() uses url.searchParams.set() which calls String() on values — no string[] supported; join with comma before passing
  - TriageKey type needed multi-line union format for deno fmt compliance (single-line >100 chars fails fmt)
  - The _group param in the count endpoint spec uses explode:false (comma-separated), consistent with joining the array
---

## 2026-02-19 - PRD-F5
- Implemented issue pending approval endpoints across all layers:
  1. src/types/polaris.ts: Added PendingApprovalAction type alias and PendingApprovalRequest interface
  2. src/api/findings.ts: Added CONTENT_TYPE_CHANGE_PENDING_FIX_BY and CONTENT_TYPE_CHANGE_PENDING_STATUS constants; added changePendingFixBy() and changePendingStatus() (both POST, return Promise<void> for 204)
  3. src/services/findings.ts: Added changePendingFixBy() and changePendingStatus() service functions
  4. src/mcp/tools/change-pending-fix-by.ts: Created change_pending_fix_by tool (readOnlyHint: false), requires project_id and ids array
  5. src/mcp/tools/change-pending-status.ts: Created change_pending_status tool (readOnlyHint: false), requires project_id and ids array
  6. src/mcp/tools/index.ts: Registered both new tools
- Files changed: src/types/polaris.ts, src/api/findings.ts, src/services/findings.ts, src/mcp/tools/change-pending-fix-by.ts (new), src/mcp/tools/change-pending-status.ts (new), src/mcp/tools/index.ts, prd.json
- **Learnings for future iterations:**
  - Both pending approval endpoints use unique Content-Type vendor media types (not the generic ACCEPT_ISSUES)
  - For 204 endpoints (no response body), return Promise<void> from API layer; tool handler returns jsonResponse({success:true, action, count})
  - Don't import errorResponse in tool handlers unless you actually use it (lint will catch it)
---

## 2026-02-19 - PRD-F4
- Implemented issue export and count-over-time endpoints across all layers:
  1. src/types/polaris.ts: Added IssueExportItem, IssueCountOverTimeEntry, IssueCountOverTimeResponse interfaces
  2. src/api/findings.ts: Added exportIssues() (GET /api/findings/issues/_actions/export) and getIssueCountOverTime() (GET /api/findings/issues/_actions/count-over-time, NOT paginated — uses client.get())
  3. src/services/findings.ts: Added exportFindingsIssues() and getIssueCountOverTime() service functions
  4. src/mcp/tools/export-findings-issues.ts: Created export_findings_issues tool (readOnlyHint: true) — named differently from existing export_issues (bug tracking) to avoid collision
  5. src/mcp/tools/get-issue-count-over-time.ts: Created get_issue_count_over_time tool with mutual exclusivity validation for last_x_days vs from_date/to_date
  6. src/mcp/tools/index.ts: Registered both new tools
- Files changed: src/types/polaris.ts, src/api/findings.ts, src/services/findings.ts, src/mcp/tools/export-findings-issues.ts (new), src/mcp/tools/get-issue-count-over-time.ts (new), src/mcp/tools/index.ts, prd.json
- **Learnings for future iterations:**
  - count-over-time is NOT paginated — use client.get<IssueCountOverTimeResponse>() not getAllCursor
  - export endpoint returns IssueExportItem[] directly (not paginated via cursor), use client.get<T[]>()
  - Tool name collision: avoid export_issues (reserved for bug tracking); use export_findings_issues for the Findings API export
  - Mutual exclusivity validation in tool handlers should use errorResponse() and return early before calling service
---
